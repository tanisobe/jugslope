function JsExtensions(){throw new Error("This is not a class")}function Utils(){throw new Error("This is a static class")}function Point(){this.initialize.apply(this,arguments)}function Rectangle(){this.initialize.apply(this,arguments)}function Bitmap(){this.initialize.apply(this,arguments)}function Graphics(){throw new Error("This is a static class")}function Input(){throw new Error("This is a static class")}function TouchInput(){throw new Error("This is a static class")}function Sprite(){this.initialize.apply(this,arguments)}function Tilemap(){this.initialize.apply(this,arguments)}function TilingSprite(){this.initialize.apply(this,arguments)}function ScreenSprite(){this.initialize.apply(this,arguments)}function Window(){this.initialize.apply(this,arguments)}function WindowLayer(){this.initialize.apply(this,arguments)}function Weather(){this.initialize.apply(this,arguments)}function ToneFilter(){PIXI.AbstractFilter.call(this),this.initialize.apply(this,arguments)}function ToneSprite(){this.initialize.apply(this,arguments)}function Stage(){this.initialize.apply(this,arguments)}function WebAudio(){this.initialize.apply(this,arguments)}function Html5Audio(){throw new Error("This is a static class")}function JsonEx(){throw new Error("This is a static class")}Number.prototype.clamp=function(a,b){return Math.min(Math.max(this,a),b)},Number.prototype.mod=function(a){return(this%a+a)%a},String.prototype.format=function(){var a=arguments;return this.replace(/%([0-9]+)/g,function(b,c){return a[Number(c)-1]})},String.prototype.padZero=function(a){for(var b=this;b.length<a;)b="0"+b;return b},Number.prototype.padZero=function(a){return String(this).padZero(a)},Array.prototype.equals=function(a){if(!a||this.length!==a.length)return!1;for(var b=0;b<this.length;b++)if(this[b]instanceof Array&&a[b]instanceof Array){if(!this[b].equals(a[b]))return!1}else if(this[b]!==a[b])return!1;return!0},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.contains=function(a){return this.indexOf(a)>=0},String.prototype.contains=function(a){return this.indexOf(a)>=0},Math.randomInt=function(a){return Math.floor(a*Math.random())},Utils.RPGMAKER_NAME="MV",Utils.isOptionValid=function(a){return location.search.slice(1).split("&").contains(a)},Utils.isNwjs=function(){return"function"==typeof require&&"object"==typeof process},Utils.isMobileDevice=function(){var a=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;return!!navigator.userAgent.match(a)},Utils.isMobileSafari=function(){var a=navigator.userAgent;return!(!a.match(/iPhone|iPad|iPod/)||!a.match(/AppleWebKit/)||a.match("CriOS"))},Utils.isAndroidChrome=function(){var a=navigator.userAgent;return!(!a.match(/Android/)||!a.match(/Chrome/))},Utils.canReadGameFiles=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1],c=new XMLHttpRequest;try{return c.open("GET",b.src),c.overrideMimeType("text/javascript"),c.send(),!0}catch(d){return!1}},Utils.rgbToCssColor=function(a,b,c){return a=Math.round(a),b=Math.round(b),c=Math.round(c),"rgb("+a+","+b+","+c+")"},Point.prototype=Object.create(PIXI.Point.prototype),Point.prototype.constructor=Point,Point.prototype.initialize=function(a,b){PIXI.Point.call(this,a,b)},Rectangle.prototype=Object.create(PIXI.Rectangle.prototype),Rectangle.prototype.constructor=Rectangle,Rectangle.prototype.initialize=function(a,b,c,d){PIXI.Rectangle.call(this,a,b,c,d)},Rectangle.emptyRectangle=new Rectangle(0,0,0,0),Bitmap.prototype.initialize=function(a,b){this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._canvas.width=Math.max(a||0,1),this._canvas.height=Math.max(b||0,1),this._baseTexture=new PIXI.BaseTexture(this._canvas),this._baseTexture.scaleMode=PIXI.scaleModes.NEAREST,this._image=null,this._url="",this._paintOpacity=255,this._smooth=!1,this._loadListeners=[],this._isLoading=!1,this._hasError=!1,this.fontFace="GameFont",this.fontSize=28,this.fontItalic=!1,this.textColor="#ffffff",this.outlineColor="rgba(0, 0, 0, 0.5)",this.outlineWidth=4},Bitmap.load=function(a){var b=new Bitmap;return b._image=new Image,b._image.src=a,b._image.onload=Bitmap.prototype._onLoad.bind(b),b._image.onerror=Bitmap.prototype._onError.bind(b),b._url=a,b._isLoading=!0,b},Bitmap.snap=function(a){var b=Graphics.width,c=Graphics.height,d=new Bitmap(b,c),e=d._context,f=new PIXI.RenderTexture(b,c);if(a&&(f.render(a),a.worldTransform.identity()),Graphics.isWebGL()){var g=f.renderer.gl,h=new Uint8Array(4*b*c);g.bindFramebuffer(g.FRAMEBUFFER,f.textureBuffer.frameBuffer),g.readPixels(0,0,b,c,g.RGBA,g.UNSIGNED_BYTE,h),g.bindFramebuffer(g.FRAMEBUFFER,null);var i=e.getImageData(0,0,b,c);i.data.set(h),e.putImageData(i,0,0)}else e.drawImage(f.textureBuffer.canvas,0,0);return d._setDirty(),d},Bitmap.prototype.isReady=function(){return!this._isLoading},Bitmap.prototype.isError=function(){return this._hasError},Object.defineProperty(Bitmap.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(Bitmap.prototype,"baseTexture",{get:function(){return this._baseTexture},configurable:!0}),Object.defineProperty(Bitmap.prototype,"canvas",{get:function(){return this._canvas},configurable:!0}),Object.defineProperty(Bitmap.prototype,"context",{get:function(){return this._context},configurable:!0}),Object.defineProperty(Bitmap.prototype,"width",{get:function(){return this._isLoading?0:this._canvas.width},configurable:!0}),Object.defineProperty(Bitmap.prototype,"height",{get:function(){return this._isLoading?0:this._canvas.height},configurable:!0}),Object.defineProperty(Bitmap.prototype,"rect",{get:function(){return new Rectangle(0,0,this.width,this.height)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"smooth",{get:function(){return this._smooth},set:function(a){this._smooth!==a&&(this._smooth=a,this._smooth?this._baseTexture.scaleMode=PIXI.scaleModes.LINEAR:this._baseTexture.scaleMode=PIXI.scaleModes.NEAREST)},configurable:!0}),Object.defineProperty(Bitmap.prototype,"paintOpacity",{get:function(){return this._paintOpacity},set:function(a){this._paintOpacity!==a&&(this._paintOpacity=a,this._context.globalAlpha=this._paintOpacity/255)},configurable:!0}),Bitmap.prototype.resize=function(a,b){a=Math.max(a||0,1),b=Math.max(b||0,1),this._canvas.width=a,this._canvas.height=b,this._baseTexture.width=a,this._baseTexture.height=b},Bitmap.prototype.blt=function(a,b,c,d,e,f,g,h,i){h=h||d,i=i||e,b>=0&&c>=0&&d>0&&e>0&&h>0&&i>0&&b+d<=a.width&&c+e<=a.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(a._canvas,b,c,d,e,f,g,h,i),this._setDirty())},Bitmap.prototype.getPixel=function(a,b){for(var c=this._context.getImageData(a,b,1,1).data,d="#",e=0;3>e;e++)d+=c[e].toString(16).padZero(2);return d},Bitmap.prototype.getAlphaPixel=function(a,b){var c=this._context.getImageData(a,b,1,1).data;return c[3]},Bitmap.prototype.clearRect=function(a,b,c,d){this._context.clearRect(a,b,c,d),this._setDirty()},Bitmap.prototype.clear=function(){this.clearRect(0,0,this.width,this.height)},Bitmap.prototype.fillRect=function(a,b,c,d,e){var f=this._context;f.save(),f.fillStyle=e,f.fillRect(a,b,c,d),f.restore(),this._setDirty()},Bitmap.prototype.fillAll=function(a){this.fillRect(0,0,this.width,this.height,a)},Bitmap.prototype.gradientFillRect=function(a,b,c,d,e,f,g){var h,i=this._context;h=g?i.createLinearGradient(a,b,a,b+d):i.createLinearGradient(a,b,a+c,b),h.addColorStop(0,e),h.addColorStop(1,f),i.save(),i.fillStyle=h,i.fillRect(a,b,c,d),i.restore(),this._setDirty()},Bitmap.prototype.drawCircle=function(a,b,c,d){var e=this._context;e.save(),e.fillStyle=d,e.beginPath(),e.arc(a,b,c,0,2*Math.PI,!1),e.fill(),e.restore(),this._setDirty()},Bitmap.prototype.drawText=function(a,b,c,d,e,f){if(void 0!==a){var g=b,h=c+e-(e-.7*this.fontSize)/2,i=this._context,j=i.globalAlpha;d=d||4294967295,"center"===f&&(g+=d/2),"right"===f&&(g+=d),i.save(),i.font=this._makeFontNameText(),i.textAlign=f,i.textBaseline="alphabetic",i.globalAlpha=1,this._drawTextOutline(a,g,h,d),i.globalAlpha=j,this._drawTextBody(a,g,h,d),i.restore(),this._setDirty()}},Bitmap.prototype.measureTextWidth=function(a){var b=this._context;b.save(),b.font=this._makeFontNameText();var c=b.measureText(a).width;return b.restore(),c},Bitmap.prototype.adjustTone=function(a,b,c){if((a||b||c)&&this.width>0&&this.height>0){for(var d=this._context,e=d.getImageData(0,0,this.width,this.height),f=e.data,g=0;g<f.length;g+=4)f[g+0]+=a,f[g+1]+=b,f[g+2]+=c;d.putImageData(e,0,0),this._setDirty()}},Bitmap.prototype.rotateHue=function(a){function b(a,b,c){var d=Math.min(a,b,c),e=Math.max(a,b,c),f=0,g=0,h=(d+e)/2,i=e-d;return i>0&&(f=a===e?60*(((b-c)/i+6)%6):b===e?60*((c-a)/i+2):60*((a-b)/i+4),g=i/(255-Math.abs(2*h-255))),[f,g,h]}function c(a,b,c){var d=(255-Math.abs(2*c-255))*b,e=d*(1-Math.abs(a/60%2-1)),f=c-d/2,g=d+f,h=e+f;return 60>a?[g,h,f]:120>a?[h,g,f]:180>a?[f,g,h]:240>a?[f,h,g]:300>a?[h,f,g]:[g,f,h]}if(a&&this.width>0&&this.height>0){a=(a%360+360)%360;for(var d=this._context,e=d.getImageData(0,0,this.width,this.height),f=e.data,g=0;g<f.length;g+=4){var h=b(f[g+0],f[g+1],f[g+2]),i=(h[0]+a)%360,j=h[1],k=h[2],l=c(i,j,k);f[g+0]=l[0],f[g+1]=l[1],f[g+2]=l[2]}d.putImageData(e,0,0),this._setDirty()}},Bitmap.prototype.blur=function(){for(var a=0;2>a;a++){var b=this.width,c=this.height,d=this._canvas,e=this._context,f=document.createElement("canvas"),g=f.getContext("2d");f.width=b+2,f.height=c+2,g.drawImage(d,0,0,b,c,1,1,b,c),g.drawImage(d,0,0,b,1,1,0,b,1),g.drawImage(d,0,0,1,c,0,1,1,c),g.drawImage(d,0,c-1,b,1,1,c+1,b,1),g.drawImage(d,b-1,0,1,c,b+1,1,1,c),e.save(),e.fillStyle="black",e.fillRect(0,0,b,c),e.globalCompositeOperation="lighter",e.globalAlpha=1/9;for(var h=0;3>h;h++)for(var i=0;3>i;i++)e.drawImage(f,i,h,b,c,0,0,b,c);e.restore()}this._setDirty()},Bitmap.prototype.addLoadListener=function(a){this._isLoading?this._loadListeners.push(a):a()},Bitmap.prototype._makeFontNameText=function(){return(this.fontItalic?"Italic ":"")+this.fontSize+"px "+this.fontFace},Bitmap.prototype._drawTextOutline=function(a,b,c,d){var e=this._context;e.strokeStyle=this.outlineColor,e.lineWidth=this.outlineWidth,e.lineJoin="round",e.strokeText(a,b,c,d)},Bitmap.prototype._drawTextBody=function(a,b,c,d){var e=this._context;e.fillStyle=this.textColor,e.fillText(a,b,c,d)},Bitmap.prototype._onLoad=function(){this._isLoading=!1,this.resize(this._image.width,this._image.height),this._context.drawImage(this._image,0,0),this._setDirty(),this._callLoadListeners()},Bitmap.prototype._callLoadListeners=function(){for(;this._loadListeners.length>0;){var a=this._loadListeners.shift();a()}},Bitmap.prototype._onError=function(){this._hasError=!0},Bitmap.prototype._setDirty=function(){this._baseTexture.dirty()},Graphics.initialize=function(a,b,c){this._width=a||800,this._height=b||600,this._rendererType=c||"auto",this._boxWidth=this._width,this._boxHeight=this._height,this._scale=1,this._realScale=1,this._errorPrinter=null,this._canvas=null,this._video=null,this._upperCanvas=null,this._renderer=null,this._fpsMeter=null,this._modeBox=null,this._skipCount=0,this._maxSkip=3,this._rendered=!1,this._loadingImage=null,this._loadingCount=0,this._fpsMeterToggled=!1,this._stretchEnabled=this._defaultStretchMode(),this._canUseDifferenceBlend=!1,this._canUseSaturationBlend=!1,this._hiddenCanvas=null,this._testCanvasBlendModes(),this._modifyExistingElements(),this._updateRealScale(),this._createAllElements(),this._disableTextSelection(),this._disableContextMenu(),this._setupEventHandlers()},Graphics.frameCount=0,Graphics.BLEND_NORMAL=0,Graphics.BLEND_ADD=1,Graphics.BLEND_MULTIPLY=2,Graphics.BLEND_SCREEN=3,Graphics.tickStart=function(){this._fpsMeter&&this._fpsMeter.tickStart()},Graphics.tickEnd=function(){this._fpsMeter&&this._rendered&&this._fpsMeter.tick()},Graphics.render=function(a){if(0===this._skipCount){var b=Date.now();a&&this._renderer.render(a);var c=Date.now(),d=c-b;this._skipCount=Math.min(Math.floor(d/15),this._maxSkip),this._rendered=!0}else this._skipCount--,this._rendered=!1;this.frameCount++},Graphics.isWebGL=function(){return this._renderer&&this._renderer.type===PIXI.WEBGL_RENDERER},Graphics.hasWebGL=function(){try{var a=document.createElement("canvas");return!(!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}},Graphics.canUseDifferenceBlend=function(){return this._canUseDifferenceBlend},Graphics.canUseSaturationBlend=function(){return this._canUseSaturationBlend},Graphics.setLoadingImage=function(a){this._loadingImage=new Image,this._loadingImage.src=a},Graphics.startLoading=function(){this._loadingCount=0},Graphics.updateLoading=function(){this._loadingCount++,this._paintUpperCanvas(),this._upperCanvas.style.opacity=1},Graphics.endLoading=function(){this._clearUpperCanvas(),this._upperCanvas.style.opacity=0},Graphics.printError=function(a,b){this._errorPrinter&&(this._errorPrinter.innerHTML=this._makeErrorHtml(a,b)),this._applyCanvasFilter(),this._clearUpperCanvas()},Graphics.showFps=function(){this._fpsMeter&&(this._fpsMeter.show(),this._modeBox.style.opacity=1)},Graphics.hideFps=function(){this._fpsMeter&&(this._fpsMeter.hide(),this._modeBox.style.opacity=0)},Graphics.loadFont=function(a,b){var c=document.createElement("style"),d=document.getElementsByTagName("head"),e='@font-face { font-family: "'+a+'"; src: url("'+b+'"); }';c.type="text/css",d.item(0).appendChild(c),c.sheet.insertRule(e,0),this._createFontLoader(a)},Graphics.isFontLoaded=function(a){this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));var b,c,d=this._hiddenCanvas.getContext("2d"),e="abcdefghijklmnopqrstuvwxyz";return d.font="40px "+a+", sans-serif",b=d.measureText(e).width,d.font="40px sans-serif",c=d.measureText(e).width,b!==c},Graphics.playVideo=function(a){this._video.src=a,this._video.onloadeddata=this._onVideoLoad.bind(this),this._video.onerror=this._onVideoError.bind(this),this._video.onended=this._onVideoEnd.bind(this),this._video.load()},Graphics.isVideoPlaying=function(){return this._video&&this._isVideoVisible()},Graphics.canPlayVideoType=function(a){return this._video&&this._video.canPlayType(a)},Graphics.pageToCanvasX=function(a){if(this._canvas){var b=this._canvas.offsetLeft;return Math.round((a-b)/this._realScale)}return 0},Graphics.pageToCanvasY=function(a){if(this._canvas){var b=this._canvas.offsetTop;return Math.round((a-b)/this._realScale)}return 0},Graphics.isInsideCanvas=function(a,b){return a>=0&&a<this._width&&b>=0&&b<this._height},Object.defineProperty(Graphics,"width",{get:function(){return this._width},set:function(a){this._width!==a&&(this._width=a,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"height",{get:function(){return this._height},set:function(a){this._height!==a&&(this._height=a,this._updateAllElements())},configurable:!0}),Object.defineProperty(Graphics,"boxWidth",{get:function(){return this._boxWidth},set:function(a){this._boxWidth=a},configurable:!0}),Object.defineProperty(Graphics,"boxHeight",{get:function(){return this._boxHeight},set:function(a){this._boxHeight=a},configurable:!0}),Object.defineProperty(Graphics,"scale",{get:function(){return this._scale},set:function(a){this._scale!==a&&(this._scale=a,this._updateAllElements())},configurable:!0}),Graphics._createAllElements=function(){this._createErrorPrinter(),this._createCanvas(),this._createVideo(),this._createUpperCanvas(),this._createRenderer(),this._createFPSMeter(),this._createModeBox(),this._createGameFontLoader()},Graphics._updateAllElements=function(){this._updateRealScale(),this._updateErrorPrinter(),this._updateCanvas(),this._updateVideo(),this._updateUpperCanvas(),this._updateRenderer(),this._paintUpperCanvas()},Graphics._updateRealScale=function(){if(this._stretchEnabled){var a=window.innerWidth/this._width,b=window.innerHeight/this._height;this._realScale=Math.min(a,b)}else this._realScale=this._scale},Graphics._makeErrorHtml=function(a,b){return'<font color="yellow"><b>'+a+'</b></font><br><font color="white">'+b+"</font><br>"},Graphics._defaultStretchMode=function(){return Utils.isNwjs()||Utils.isMobileDevice()},Graphics._testCanvasBlendModes=function(){var a,b,c,d;a=document.createElement("canvas"),a.width=1,a.height=1,b=a.getContext("2d"),b.globalCompositeOperation="source-over",b.fillStyle="white",b.fillRect(0,0,1,1),b.globalCompositeOperation="difference",b.fillStyle="white",b.fillRect(0,0,1,1),c=b.getImageData(0,0,1,1),b.globalCompositeOperation="source-over",b.fillStyle="black",b.fillRect(0,0,1,1),b.globalCompositeOperation="saturation",b.fillStyle="white",b.fillRect(0,0,1,1),d=b.getImageData(0,0,1,1),this._canUseDifferenceBlend=0===c.data[0],this._canUseSaturationBlend=0===d.data[0]},Graphics._modifyExistingElements=function(){for(var a=document.getElementsByTagName("*"),b=0;b<a.length;b++)a[b].style.zIndex>0&&(a[b].style.zIndex=0)},Graphics._createErrorPrinter=function(){this._errorPrinter=document.createElement("p"),this._errorPrinter.id="ErrorPrinter",this._updateErrorPrinter(),document.body.appendChild(this._errorPrinter)},Graphics._updateErrorPrinter=function(){this._errorPrinter.width=.9*this._width,this._errorPrinter.height=40,this._errorPrinter.style.textAlign="center",this._errorPrinter.style.textShadow="1px 1px 3px #000",this._errorPrinter.style.fontSize="20px",this._errorPrinter.style.zIndex=99,this._centerElement(this._errorPrinter)},Graphics._createCanvas=function(){this._canvas=document.createElement("canvas"),this._canvas.id="GameCanvas",this._updateCanvas(),document.body.appendChild(this._canvas)},Graphics._updateCanvas=function(){this._canvas.width=this._width,this._canvas.height=this._height,this._canvas.style.zIndex=1,this._centerElement(this._canvas)},Graphics._createVideo=function(){this._video=document.createElement("video"),this._video.id="GameVideo",this._video.style.opacity=0,this._updateVideo(),document.body.appendChild(this._video)},Graphics._updateVideo=function(){this._video.width=this._width,this._video.height=this._height,this._video.style.zIndex=2,this._centerElement(this._video)},Graphics._createUpperCanvas=function(){this._upperCanvas=document.createElement("canvas"),this._upperCanvas.id="UpperCanvas",this._updateUpperCanvas(),document.body.appendChild(this._upperCanvas)},Graphics._updateUpperCanvas=function(){this._upperCanvas.width=this._width,this._upperCanvas.height=this._height,this._upperCanvas.style.zIndex=3,this._centerElement(this._upperCanvas)},Graphics._clearUpperCanvas=function(){var a=this._upperCanvas.getContext("2d");a.clearRect(0,0,this._width,this._height)},Graphics._paintUpperCanvas=function(){if(this._clearUpperCanvas(),this._loadingImage&&this._loadingCount>=20){var a=this._upperCanvas.getContext("2d"),b=(this._width-this._loadingImage.width)/2,c=(this._height-this._loadingImage.height)/2,d=((this._loadingCount-20)/30).clamp(0,1);a.save(),a.globalAlpha=d,a.drawImage(this._loadingImage,b,c),a.restore()}},Graphics._createRenderer=function(){PIXI.dontSayHello=!0;var a=this._width,b=this._height,c={view:this._canvas};try{switch(this._rendererType){case"canvas":this._renderer=new PIXI.CanvasRenderer(a,b,c);break;case"webgl":this._renderer=new PIXI.WebGLRenderer(a,b,c);break;default:this._renderer=PIXI.autoDetectRenderer(a,b,c)}}catch(d){this._renderer=null}},Graphics._updateRenderer=function(){this._renderer&&this._renderer.resize(this._width,this._height)},Graphics._createFPSMeter=function(){var a={graph:1,decimals:0,theme:"transparent",toggleOn:null};this._fpsMeter=new FPSMeter(a),this._fpsMeter.hide()},Graphics._createModeBox=function(){var a=document.createElement("div");a.id="modeTextBack",a.style.position="absolute",a.style.left="5px",a.style.top="5px",a.style.width="119px",a.style.height="58px",a.style.background="rgba(0,0,0,0.2)",a.style.zIndex=9,a.style.opacity=0;var b=document.createElement("div");b.id="modeText",b.style.position="absolute",b.style.left="0px",b.style.top="41px",b.style.width="119px",b.style.fontSize="12px",b.style.fontFamily="monospace",b.style.color="white",b.style.textAlign="center",b.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)",b.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode",document.body.appendChild(a),a.appendChild(b),this._modeBox=a},Graphics._createGameFontLoader=function(){this._createFontLoader("GameFont")},Graphics._createFontLoader=function(a){var b=document.createElement("div"),c=document.createTextNode(".");b.style.fontFamily=a,b.style.fontSize="0px",b.style.color="transparent",b.style.position="absolute",b.style.margin="auto",b.style.top="0px",b.style.left="0px",b.style.width="1px",b.style.height="1px",b.appendChild(c),document.body.appendChild(b)},Graphics._centerElement=function(a){var b=a.width*this._realScale,c=a.height*this._realScale;a.style.position="absolute",a.style.margin="auto",a.style.top=0,a.style.left=0,a.style.right=0,a.style.bottom=0,a.style.width=b+"px",a.style.height=c+"px"},Graphics._disableTextSelection=function(){var a=document.body;a.style.userSelect="none",a.style.webkitUserSelect="none",a.style.msUserSelect="none",a.style.mozUserSelect="none"},Graphics._disableContextMenu=function(){for(var a=document.body.getElementsByTagName("*"),b=function(){return!1},c=0;c<a.length;c++)a[c].oncontextmenu=b},Graphics._applyCanvasFilter=function(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")},Graphics._onVideoLoad=function(){this._video.play(),this._updateVisibility(!0)},Graphics._onVideoError=function(){this._updateVisibility(!1)},Graphics._onVideoEnd=function(){this._updateVisibility(!1)},Graphics._updateVisibility=function(a){this._video.style.opacity=a?1:0,this._canvas.style.opacity=a?0:1},Graphics._isVideoVisible=function(){return this._video.style.opacity>0},Graphics._setupEventHandlers=function(){window.addEventListener("resize",this._onWindowResize.bind(this)),document.addEventListener("keydown",this._onKeyDown.bind(this))},Graphics._onWindowResize=function(){this._updateAllElements()},Graphics._onKeyDown=function(a){if(!a.ctrlKey&&!a.altKey)switch(a.keyCode){case 113:a.preventDefault(),this._switchFPSMeter();break;case 114:a.preventDefault(),this._switchStretchMode();break;case 115:a.preventDefault(),this._switchFullScreen()}},Graphics._switchFPSMeter=function(){this._fpsMeter.isPaused?(this.showFps(),this._fpsMeter.showFps(),this._fpsMeterToggled=!1):this._fpsMeterToggled?this.hideFps():(this._fpsMeter.showDuration(),this._fpsMeterToggled=!0)},Graphics._switchStretchMode=function(){this._stretchEnabled=!this._stretchEnabled,this._updateAllElements()},Graphics._switchFullScreen=function(){this._isFullScreen()?this._requestFullScreen():this._cancelFullScreen()},Graphics._isFullScreen=function(){return document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitFullscreenElement&&!document.msFullscreenElement},Graphics._requestFullScreen=function(){var a=document.body;a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.msRequestFullscreen&&a.msRequestFullscreen()},Graphics._cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},Input.initialize=function(){this.clear(),this._wrapNwjsAlert(),this._setupEventHandlers()},Input.keyRepeatWait=24,Input.keyRepeatInterval=6,Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"},Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"},Input.clear=function(){this._currentState={},this._previousState={},this._gamepadStates=[],this._latestButton=null,this._pressedTime=0,this._dir4=0,this._dir8=0,this._preferredAxis="",this._date=0},Input.update=function(){this._pollGamepads(),this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null;for(var a in this._currentState)this._currentState[a]&&!this._previousState[a]&&(this._latestButton=a,this._pressedTime=0,this._date=Date.now()),this._previousState[a]=this._currentState[a];this._updateDirection()},Input.isPressed=function(a){return this._isEscapeCompatible(a)&&this.isPressed("escape")?!0:!!this._currentState[a]},Input.isTriggered=function(a){return this._isEscapeCompatible(a)&&this.isTriggered("escape")?!0:this._latestButton===a&&0===this._pressedTime},Input.isRepeated=function(a){return this._isEscapeCompatible(a)&&this.isRepeated("escape")?!0:this._latestButton===a&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval===0)},Input.isLongPressed=function(a){return this._isEscapeCompatible(a)&&this.isLongPressed("escape")?!0:this._latestButton===a&&this._pressedTime>=this.keyRepeatWait},Object.defineProperty(Input,"dir4",{get:function(){return this._dir4},configurable:!0}),Object.defineProperty(Input,"dir8",{get:function(){return this._dir8},configurable:!0}),Object.defineProperty(Input,"date",{get:function(){return this._date},configurable:!0}),Input._wrapNwjsAlert=function(){if(Utils.isNwjs()){var a=window.alert;window.alert=function(){var b=require("nw.gui"),c=b.Window.get();a.apply(this,arguments),c.focus(),Input.clear()}}},Input._setupEventHandlers=function(){document.addEventListener("keydown",this._onKeyDown.bind(this)),document.addEventListener("keyup",this._onKeyUp.bind(this)),window.addEventListener("blur",this._onLostFocus.bind(this))},Input._onKeyDown=function(a){this._shouldPreventDefault(a.keyCode)&&a.preventDefault(),144===a.keyCode&&this.clear();var b=this.keyMapper[a.keyCode];b&&(this._currentState[b]=!0)},Input._shouldPreventDefault=function(a){switch(a){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1},Input._onKeyUp=function(a){var b=this.keyMapper[a.keyCode];b&&(this._currentState[b]=!1),0===a.keyCode&&this.clear()},Input._onLostFocus=function(){this.clear()},Input._pollGamepads=function(){if(navigator.getGamepads){var a=navigator.getGamepads();if(a)for(var b=0;b<a.length;b++){var c=a[b];c&&c.connected&&this._updateGamepadState(c)}}},Input._updateGamepadState=function(a){for(var b=this._gamepadStates[a.index]||[],c=[],d=a.buttons,e=a.axes,f=.5,g=0;g<d.length;g++)c[g]=d[g].pressed;e[1]<-f?c[12]=!0:e[1]>f&&(c[13]=!0),e[0]<-f?c[14]=!0:e[0]>f&&(c[15]=!0);for(var h=0;h<c.length;h++)if(c[h]!==b[h]){var i=this.gamepadMapper[h];i&&(this._currentState[i]=c[h])}this._gamepadStates[a.index]=c},Input._updateDirection=function(){var a=this._signX(),b=this._signY();this._dir8=this._makeNumpadDirection(a,b),0!==a&&0!==b?"x"===this._preferredAxis?b=0:a=0:0!==a?this._preferredAxis="y":0!==b&&(this._preferredAxis="x"),this._dir4=this._makeNumpadDirection(a,b)},Input._signX=function(){var a=0;return this.isPressed("left")&&a--,this.isPressed("right")&&a++,a},Input._signY=function(){var a=0;return this.isPressed("up")&&a--,this.isPressed("down")&&a++,a},Input._makeNumpadDirection=function(a,b){return 0!==a||0!==b?5-3*b+a:0},Input._isEscapeCompatible=function(a){return"cancel"===a||"menu"===a},TouchInput.initialize=function(){this.clear(),this._setupEventHandlers()},TouchInput.keyRepeatWait=24,TouchInput.keyRepeatInterval=6,TouchInput.clear=function(){this._mousePressed=!1,this._screenPressed=!1,this._pressedTime=0,this._events={},this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this._triggered=!1,this._cancelled=!1,this._moved=!1,this._released=!1,this._wheelX=0,this._wheelY=0,this._x=0,this._y=0,this._date=0},TouchInput.update=function(){this._triggered=this._events.triggered,this._cancelled=this._events.cancelled,this._moved=this._events.moved,this._released=this._events.released,this._wheelX=this._events.wheelX,this._wheelY=this._events.wheelY,this._events.triggered=!1,this._events.cancelled=!1,this._events.moved=!1,this._events.released=!1,this._events.wheelX=0,this._events.wheelY=0,this.isPressed()&&this._pressedTime++},TouchInput.isPressed=function(){return this._mousePressed||this._screenPressed},TouchInput.isTriggered=function(){return this._triggered},TouchInput.isRepeated=function(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&this._pressedTime%this.keyRepeatInterval===0)},TouchInput.isLongPressed=function(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait},TouchInput.isCancelled=function(){return this._cancelled},TouchInput.isMoved=function(){return this._moved},TouchInput.isReleased=function(){return this._released},Object.defineProperty(TouchInput,"wheelX",{get:function(){return this._wheelX},configurable:!0}),Object.defineProperty(TouchInput,"wheelY",{get:function(){return this._wheelY},configurable:!0}),Object.defineProperty(TouchInput,"x",{get:function(){return this._x},configurable:!0}),Object.defineProperty(TouchInput,"y",{get:function(){return this._y},configurable:!0}),Object.defineProperty(TouchInput,"date",{get:function(){return this._date},configurable:!0}),TouchInput._setupEventHandlers=function(){document.addEventListener("mousedown",this._onMouseDown.bind(this)),document.addEventListener("mousemove",this._onMouseMove.bind(this)),document.addEventListener("mouseup",this._onMouseUp.bind(this)),document.addEventListener("wheel",this._onWheel.bind(this)),document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("touchmove",this._onTouchMove.bind(this)),document.addEventListener("touchend",this._onTouchEnd.bind(this)),document.addEventListener("touchcancel",this._onTouchCancel.bind(this)),document.addEventListener("pointerdown",this._onPointerDown.bind(this))},TouchInput._onMouseDown=function(a){0===a.button?this._onLeftButtonDown(a):1===a.button?this._onMiddleButtonDown(a):2===a.button&&this._onRightButtonDown(a)},TouchInput._onLeftButtonDown=function(a){var b=Graphics.pageToCanvasX(a.pageX),c=Graphics.pageToCanvasY(a.pageY);Graphics.isInsideCanvas(b,c)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(b,c))},TouchInput._onMiddleButtonDown=function(a){},TouchInput._onRightButtonDown=function(a){var b=Graphics.pageToCanvasX(a.pageX),c=Graphics.pageToCanvasY(a.pageY);Graphics.isInsideCanvas(b,c)&&this._onCancel(b,c)},TouchInput._onMouseMove=function(a){if(this._mousePressed){var b=Graphics.pageToCanvasX(a.pageX),c=Graphics.pageToCanvasY(a.pageY);this._onMove(b,c)}},TouchInput._onMouseUp=function(a){if(0===a.button){var b=Graphics.pageToCanvasX(a.pageX),c=Graphics.pageToCanvasY(a.pageY);this._mousePressed=!1,this._onRelease(b,c)}},TouchInput._onWheel=function(a){this._events.wheelX+=a.deltaX,this._events.wheelY+=a.deltaY,a.preventDefault()},TouchInput._onTouchStart=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d=Graphics.pageToCanvasX(c.pageX),e=Graphics.pageToCanvasY(c.pageY);Graphics.isInsideCanvas(d,e)&&(this._screenPressed=!0,this._pressedTime=0,a.touches.length>=2?this._onCancel(d,e):this._onTrigger(d,e),a.preventDefault())}(window.cordova||window.navigator.standalone)&&a.preventDefault()},TouchInput._onTouchMove=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d=Graphics.pageToCanvasX(c.pageX),e=Graphics.pageToCanvasY(c.pageY);this._onMove(d,e)}},TouchInput._onTouchEnd=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d=Graphics.pageToCanvasX(c.pageX),e=Graphics.pageToCanvasY(c.pageY);this._screenPressed=!1,this._onRelease(d,e)}},TouchInput._onTouchCancel=function(a){this._screenPressed=!1},TouchInput._onPointerDown=function(a){if("touch"===a.pointerType&&!a.isPrimary){
var b=Graphics.pageToCanvasX(a.pageX),c=Graphics.pageToCanvasY(a.pageY);Graphics.isInsideCanvas(b,c)&&(this._onCancel(b,c),a.preventDefault())}},TouchInput._onTrigger=function(a,b){this._events.triggered=!0,this._x=a,this._y=b,this._date=Date.now()},TouchInput._onCancel=function(a,b){this._events.cancelled=!0,this._x=a,this._y=b},TouchInput._onMove=function(a,b){this._events.moved=!0,this._x=a,this._y=b},TouchInput._onRelease=function(a,b){this._events.released=!0,this._x=a,this._y=b},Sprite.prototype=Object.create(PIXI.Sprite.prototype),Sprite.prototype.constructor=Sprite,Sprite.prototype.initialize=function(a){var b=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,b),this._bitmap=null,this._frame=new Rectangle,this._realFrame=new Rectangle,this._offset=new Point,this._blendColor=[0,0,0,0],this._colorTone=[0,0,0,0],this._canvas=null,this._context=null,this._tintTexture=null,this.spriteId=Sprite._counter++,this.opaque=!1,this.bitmap=a},Sprite._counter=0,Object.defineProperty(Sprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(a){this._bitmap!==a&&(this._bitmap=a,this._bitmap?(this.setFrame(0,0,0,0),this._bitmap.addLoadListener(this._onBitmapLoad.bind(this))):this.texture.setFrame(Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(Sprite.prototype,"width",{get:function(){return this._frame.width},set:function(a){this._frame.width=a,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"height",{get:function(){return this._frame.height},set:function(a){this._frame.height=a,this._refresh()},configurable:!0}),Object.defineProperty(Sprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0}),Sprite.prototype.update=function(){this.children.forEach(function(a){a.update&&a.update()})},Sprite.prototype.move=function(a,b){this.x=a,this.y=b},Sprite.prototype.setFrame=function(a,b,c,d){var e=this._frame;(a!==e.x||b!==e.y||c!==e.width||d!==e.height)&&(e.x=a,e.y=b,e.width=c,e.height=d,this._refresh())},Sprite.prototype.getBlendColor=function(){return this._blendColor.clone()},Sprite.prototype.setBlendColor=function(a){if(!(a instanceof Array))throw new Error("Argument must be an array");this._blendColor.equals(a)||(this._blendColor=a.clone(),this._refresh())},Sprite.prototype.getColorTone=function(){return this._colorTone.clone()},Sprite.prototype.setColorTone=function(a){if(!(a instanceof Array))throw new Error("Argument must be an array");this._colorTone.equals(a)||(this._colorTone=a.clone(),this._refresh())},Sprite.prototype._onBitmapLoad=function(){0===this._frame.width&&0===this._frame.height&&(this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height),this._refresh()},Sprite.prototype._refresh=function(){var a=Math.floor(this._frame.x),b=Math.floor(this._frame.y),c=Math.floor(this._frame.width),d=Math.floor(this._frame.height),e=this._bitmap?this._bitmap.width:0,f=this._bitmap?this._bitmap.height:0,g=a.clamp(0,e),h=b.clamp(0,f),i=(c-g+a).clamp(0,e-g),j=(d-h+b).clamp(0,f-h);this._realFrame.x=g,this._realFrame.y=h,this._realFrame.width=i,this._realFrame.height=j,this._offset.x=g-a,this._offset.y=h-b,i>0&&j>0?this._needsTint()?(this._createTinter(i,j),this._executeTint(g,h,i,j),this._tintTexture.dirty(),this.texture.baseTexture=this._tintTexture,this.texture.setFrame(new Rectangle(0,0,i,j))):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.setFrame(this._realFrame)):this._bitmap?this.texture.setFrame(Rectangle.emptyRectangle):(this.texture.trim=this._frame,this.texture.setFrame(this._frame),this.texture.trim=null)},Sprite.prototype._isInBitmapRect=function(a,b,c,d){return this._bitmap&&a+c>0&&b+d>0&&a<this._bitmap.width&&b<this._bitmap.height},Sprite.prototype._needsTint=function(){var a=this._colorTone;return a[0]||a[1]||a[2]||a[3]||this._blendColor[3]>0},Sprite.prototype._createTinter=function(a,b){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d")),this._canvas.width=a,this._canvas.height=b,this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas)),this._tintTexture.width=a,this._tintTexture.height=b,this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode},Sprite.prototype._executeTint=function(a,b,c,d){var e=this._context,f=this._colorTone,g=this._blendColor;if(e.globalCompositeOperation="copy",e.drawImage(this._bitmap.canvas,a,b,c,d,0,0,c,d),Graphics.canUseSaturationBlend()){var h=Math.max(0,f[3]);e.globalCompositeOperation="saturation",e.fillStyle="rgba(255,255,255,"+h/255+")",e.fillRect(0,0,c,d)}var i=Math.max(0,f[0]),j=Math.max(0,f[1]),k=Math.max(0,f[2]);if(e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(i,j,k),e.fillRect(0,0,c,d),Graphics.canUseDifferenceBlend()){e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,c,d);var l=Math.max(0,-f[0]),m=Math.max(0,-f[1]),n=Math.max(0,-f[2]);e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(l,m,n),e.fillRect(0,0,c,d),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,c,d)}var o=Math.max(0,g[0]),p=Math.max(0,g[1]),q=Math.max(0,g[2]),r=Math.max(0,g[3]);e.globalCompositeOperation="source-atop",e.fillStyle=Utils.rgbToCssColor(o,p,q),e.globalAlpha=r/255,e.fillRect(0,0,c,d),e.globalCompositeOperation="destination-in",e.globalAlpha=1,e.drawImage(this._bitmap.canvas,a,b,c,d,0,0,c,d)},Sprite.prototype.updateTransform=function(){PIXI.Sprite.prototype.updateTransform.call(this),this.worldTransform.tx+=this._offset.x,this.worldTransform.ty+=this._offset.y},Sprite.prototype._renderCanvas=function(a){if(this.visible&&this.alpha>0)if(this.texture.crop.width<=0||this.texture.crop.height<=0){this._mask&&a.maskManager.pushMask(this._mask,a);for(var b=0,c=this.children.length;c>b;b++)this.children[b]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}else PIXI.Sprite.prototype._renderCanvas.call(this,a)},Sprite.prototype._renderWebGL=function(a){if(this.visible&&this.alpha>0){var b=a.spriteBatch;this._filters&&(b.flush(),a.filterManager.pushFilter(this._filterBlock),this.opaque&&(a.gl.clearColor(0,0,0,1),a.gl.clear(a.gl.COLOR_BUFFER_BIT))),this._mask&&(b.stop(),a.maskManager.pushMask(this.mask,a),b.start()),b.render(this);for(var c=0,d=this.children.length;d>c;c++)this.children[c]._renderWebGL(a);this._mask&&(b.stop(),a.maskManager.popMask(this._mask,a),b.start()),this._filters&&(b.stop(),a.filterManager.popFilter(),b.start())}},Tilemap.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._margin=20,this._width=Graphics.width+2*this._margin,this._height=Graphics.height+2*this._margin,this._tileWidth=48,this._tileHeight=48,this._mapWidth=0,this._mapHeight=0,this._mapData=null,this._layerWidth=0,this._layerHeight=0,this._lastTiles=[],this.bitmaps=[],this.origin=new Point,this.flags=[],this.animationCount=0,this.horizontalWrap=!1,this.verticalWrap=!1,this._createLayers(),this.refresh()},Object.defineProperty(Tilemap.prototype,"width",{get:function(){return this._width},set:function(a){this._width!==a&&(this._width=a,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"height",{get:function(){return this._height},set:function(a){this._height!==a&&(this._height=a,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(a){this._tileWidth!==a&&(this._tileWidth=a,this._createLayers())}}),Object.defineProperty(Tilemap.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(a){this._tileHeight!==a&&(this._tileHeight=a,this._createLayers())}}),Tilemap.prototype.setData=function(a,b,c){this._mapWidth=a,this._mapHeight=b,this._mapData=c},Tilemap.prototype.isReady=function(){for(var a=0;a<this.bitmaps.length;a++)if(this.bitmaps[a]&&!this.bitmaps[a].isReady())return!1;return!0},Tilemap.prototype.update=function(){this.animationCount++,this.children.forEach(function(a){a.update&&a.update()})},Tilemap.prototype.refresh=function(){this._lastTiles.length=0},Tilemap.prototype.updateTransform=function(){var a=Math.floor(this.origin.x),b=Math.floor(this.origin.y),c=Math.floor((a-this._margin)/this._tileWidth),d=Math.floor((b-this._margin)/this._tileHeight);this._updateLayerPositions(c,d),this._paintAllTiles(c,d),this._sortChildren(),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Tilemap.prototype._createLayers=function(){var a=this._width,b=this._height,c=this._margin,d=Math.ceil(a/this._tileWidth)+1,e=Math.ceil(b/this._tileHeight)+1,f=d*this._tileWidth,g=e*this._tileHeight;this._lowerBitmap=new Bitmap(f,g),this._upperBitmap=new Bitmap(f,g),this._layerWidth=f,this._layerHeight=g,this._lowerLayer=new Sprite,this._lowerLayer.move(-c,-c,a,b),this._lowerLayer.z=0,this._upperLayer=new Sprite,this._upperLayer.move(-c,-c,a,b),this._upperLayer.z=4;for(var h=0;4>h;h++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer),this.addChild(this._upperLayer)},Tilemap.prototype._updateLayerPositions=function(a,b){for(var c=this._margin,d=Math.floor(this.origin.x),e=Math.floor(this.origin.y),f=(d-c).mod(this._layerWidth),g=(e-c).mod(this._layerHeight),h=this._layerWidth-f,i=this._layerHeight-g,j=this._width-h,k=this._height-i,l=0;2>l;l++){var m;m=0===l?this._lowerLayer.children:this._upperLayer.children,m[0].move(0,0,h,i),m[0].setFrame(f,g,h,i),m[1].move(h,0,j,i),m[1].setFrame(0,g,j,i),m[2].move(0,i,h,k),m[2].setFrame(f,0,h,k),m[3].move(h,i,j,k),m[3].setFrame(0,0,j,k)}},Tilemap.prototype._paintAllTiles=function(a,b){for(var c=Math.ceil(this._width/this._tileWidth)+1,d=Math.ceil(this._height/this._tileHeight)+1,e=0;d>e;e++)for(var f=0;c>f;f++)this._paintTiles(a,b,f,e)},Tilemap.prototype._paintTiles=function(a,b,c,d){var e=1e4,f=a+c,g=b+d,h=(f*this._tileWidth).mod(this._layerWidth),i=(g*this._tileHeight).mod(this._layerHeight),j=h/this._tileWidth,k=i/this._tileHeight,l=this._readMapData(f,g,0),m=this._readMapData(f,g,1),n=this._readMapData(f,g,2),o=this._readMapData(f,g,3),p=this._readMapData(f,g,4),q=this._readMapData(f,g-1,1),r=[],s=[];this._isHigherTile(l)?s.push(l):r.push(l),this._isHigherTile(m)?s.push(m):r.push(m),r.push(-p),this._isTableTile(q)&&!this._isTableTile(m)&&(Tilemap.isShadowingTile(l)||r.push(e+q)),this._isOverpassPosition(f,g)?(s.push(n),s.push(o)):(this._isHigherTile(n)?s.push(n):r.push(n),this._isHigherTile(o)?s.push(o):r.push(o));var t=1e3+this.animationCount-g,u=t%30===0;this._animationFrame=Math.floor(t/30);var v=this._readLastTiles(0,j,k);if(!r.equals(v)||Tilemap.isTileA1(l)&&u){this._lowerBitmap.clearRect(h,i,this._tileWidth,this._tileHeight);for(var w=0;w<r.length;w++){var x=r[w];0>x?this._drawShadow(this._lowerBitmap,p,h,i):x>=e?this._drawTableEdge(this._lowerBitmap,q,h,i):this._drawTile(this._lowerBitmap,x,h,i)}this._writeLastTiles(0,j,k,r)}var y=this._readLastTiles(1,j,k);if(!s.equals(y)){this._upperBitmap.clearRect(h,i,this._tileWidth,this._tileHeight);for(var z=0;z<s.length;z++)this._drawTile(this._upperBitmap,s[z],h,i);this._writeLastTiles(1,j,k,s)}},Tilemap.prototype._readLastTiles=function(a,b,c){var d=this._lastTiles[a];if(d){var e=d[c];if(e){var f=e[b];if(f)return f}}return[]},Tilemap.prototype._writeLastTiles=function(a,b,c,d){var e=this._lastTiles[a];e||(e=this._lastTiles[a]=[]);var f=e[c];f||(f=e[c]=[]),f[b]=d},Tilemap.prototype._drawTile=function(a,b,c,d){Tilemap.isVisibleTile(b)&&(Tilemap.isAutotile(b)?this._drawAutotile(a,b,c,d):this._drawNormalTile(a,b,c,d))},Tilemap.prototype._drawNormalTile=function(a,b,c,d){var e=0;e=Tilemap.isTileA5(b)?4:5+Math.floor(b/256);var f=this._tileWidth,g=this._tileHeight,h=(Math.floor(b/128)%2*8+b%8)*f,i=Math.floor(b%256/8)%16*g,j=this.bitmaps[e];j&&a.blt(j,h,i,f,g,c,d,f,g)},Tilemap.prototype._drawAutotile=function(a,b,c,d){var e=Tilemap.FLOOR_AUTOTILE_TABLE,f=Tilemap.getAutotileKind(b),g=Tilemap.getAutotileShape(b),h=f%8,i=Math.floor(f/8),j=0,k=0,l=0,m=!1;if(Tilemap.isTileA1(b)){var n=[0,1,2,1][this._animationFrame%4];l=0,0===f?(j=2*n,k=0):1===f?(j=2*n,k=3):2===f?(j=6,k=0):3===f?(j=6,k=3):(j=8*Math.floor(h/4),k=6*i+Math.floor(h/2)%2*3,f%2===0?j+=2*n:(j+=6,e=Tilemap.WATERFALL_AUTOTILE_TABLE,k+=this._animationFrame%3))}else Tilemap.isTileA2(b)?(l=1,j=2*h,k=3*(i-2),m=this._isTableTile(b)):Tilemap.isTileA3(b)?(l=2,j=2*h,k=2*(i-6),e=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(b)&&(l=3,j=2*h,k=Math.floor(2.5*(i-10)+(i%2===1?.5:0)),i%2===1&&(e=Tilemap.WALL_AUTOTILE_TABLE));var o=e[g],p=this.bitmaps[l];if(o&&p)for(var q=this._tileWidth/2,r=this._tileHeight/2,s=0;4>s;s++){var t=o[s][0],u=o[s][1],v=(2*j+t)*q,w=(2*k+u)*r,x=c+s%2*q,y=d+Math.floor(s/2)*r;if(!m||1!==u&&5!==u)a.blt(p,v,w,q,r,x,y,q,r);else{var z=t,A=3;1===u&&(z=[0,3,2,1][t]);var B=(2*j+z)*q,C=(2*k+A)*r;a.blt(p,B,C,q,r,x,y,q,r),y+=r/2,a.blt(p,v,w,q,r/2,x,y,q,r/2)}}},Tilemap.prototype._drawTableEdge=function(a,b,c,d){if(Tilemap.isTileA2(b)){var e=Tilemap.FLOOR_AUTOTILE_TABLE,f=Tilemap.getAutotileKind(b),g=Tilemap.getAutotileShape(b),h=f%8,i=Math.floor(f/8),j=1,k=2*h,l=3*(i-2),m=e[g];if(m)for(var n=this.bitmaps[j],o=this._tileWidth/2,p=this._tileHeight/2,q=0;2>q;q++){var r=m[2+q][0],s=m[2+q][1],t=(2*k+r)*o,u=(2*l+s)*p+p/2,v=c+q%2*o,w=d+Math.floor(q/2)*p;a.blt(n,t,u,o,p/2,v,w,o,p/2)}}},Tilemap.prototype._drawShadow=function(a,b,c,d){if(15&b)for(var e=this._tileWidth/2,f=this._tileHeight/2,g="rgba(0,0,0,0.5)",h=0;4>h;h++)if(b&1<<h){var i=c+h%2*e,j=d+Math.floor(h/2)*f;a.fillRect(i,j,e,f,g)}},Tilemap.prototype._readMapData=function(a,b,c){if(this._mapData){var d=this._mapWidth,e=this._mapHeight;return this.horizontalWrap&&(a=a.mod(d)),this.verticalWrap&&(b=b.mod(e)),a>=0&&d>a&&b>=0&&e>b?this._mapData[(c*e+b)*d+a]||0:0}return 0},Tilemap.prototype._isHigherTile=function(a){return 16&this.flags[a]},Tilemap.prototype._isTableTile=function(a){return Tilemap.isTileA2(a)&&128&this.flags[a]},Tilemap.prototype._isOverpassPosition=function(a,b){return!1},Tilemap.prototype._sortChildren=function(){this.children.sort(this._compareChildOrder.bind(this))},Tilemap.prototype._compareChildOrder=function(a,b){return a.z!==b.z?a.z-b.z:a.y!==b.y?a.y-b.y:a.spriteId-b.spriteId},Tilemap.TILE_ID_B=0,Tilemap.TILE_ID_C=256,Tilemap.TILE_ID_D=512,Tilemap.TILE_ID_E=768,Tilemap.TILE_ID_A5=1536,Tilemap.TILE_ID_A1=2048,Tilemap.TILE_ID_A2=2816,Tilemap.TILE_ID_A3=4352,Tilemap.TILE_ID_A4=5888,Tilemap.TILE_ID_MAX=8192,Tilemap.isVisibleTile=function(a){return a>0&&a<this.TILE_ID_MAX},Tilemap.isAutotile=function(a){return a>=this.TILE_ID_A1},Tilemap.getAutotileKind=function(a){return Math.floor((a-this.TILE_ID_A1)/48)},Tilemap.getAutotileShape=function(a){return(a-this.TILE_ID_A1)%48},Tilemap.makeAutotileId=function(a,b){return this.TILE_ID_A1+48*a+b},Tilemap.isSameKindTile=function(a,b){return this.isAutotile(a)&&this.isAutotile(b)?this.getAutotileKind(a)===this.getAutotileKind(b):a===b},Tilemap.isTileA1=function(a){return a>=this.TILE_ID_A1&&a<this.TILE_ID_A2},Tilemap.isTileA2=function(a){return a>=this.TILE_ID_A2&&a<this.TILE_ID_A3},Tilemap.isTileA3=function(a){return a>=this.TILE_ID_A3&&a<this.TILE_ID_A4},Tilemap.isTileA4=function(a){return a>=this.TILE_ID_A4&&a<this.TILE_ID_MAX},Tilemap.isTileA5=function(a){return a>=this.TILE_ID_A5&&a<this.TILE_ID_A1},Tilemap.isWaterTile=function(a){return this.isTileA1(a)?!(a>=this.TILE_ID_A1+96&&a<this.TILE_ID_A1+192):!1},Tilemap.isWaterfallTile=function(a){return a>=this.TILE_ID_A1+192&&a<this.TILE_ID_A2?this.getAutotileKind(a)%2===1:!1},Tilemap.isGroundTile=function(a){return this.isTileA1(a)||this.isTileA2(a)||this.isTileA5(a)},Tilemap.isShadowingTile=function(a){return this.isTileA3(a)||this.isTileA4(a)},Tilemap.isRoofTile=function(a){return this.isTileA3(a)&&this.getAutotileKind(a)%16<8},Tilemap.isWallTopTile=function(a){return this.isTileA4(a)&&this.getAutotileKind(a)%16<8},Tilemap.isWallSideTile=function(a){return(this.isTileA3(a)||this.isTileA4(a))&&getAutotileKind(a)%16>=8},Tilemap.isWallTile=function(a){return this.isWallTopTile(a)||this.isWallSideTile(a)},Tilemap.isFloorTypeAutotile=function(a){return this.isTileA1(a)&&!this.isWaterfallTile(a)||this.isTileA2(a)||this.isWallTopTile(a)},Tilemap.isWallTypeAutotile=function(a){return this.isRoofTile(a)||this.isWallSideTile(a)},Tilemap.isWaterfallTypeAutotile=function(a){return this.isWaterfallTile(a)},Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]],Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]],Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]],TilingSprite.prototype=Object.create(PIXI.TilingSprite.prototype),TilingSprite.prototype.constructor=TilingSprite,TilingSprite.prototype.initialize=function(a){var b=new PIXI.Texture(new PIXI.BaseTexture);PIXI.TilingSprite.call(this,b),this._bitmap=null,this._width=0,this._height=0,this._frame=new Rectangle,this.origin=new Point,this.bitmap=a},Object.defineProperty(TilingSprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(a){this._bitmap!==a&&(this._bitmap=a,this._bitmap?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.setFrame(Rectangle.emptyRectangle))},configurable:!0}),Object.defineProperty(TilingSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0}),TilingSprite.prototype.update=function(){this.children.forEach(function(a){a.update&&a.update()})},TilingSprite.prototype.move=function(a,b,c,d){this.x=a||0,this.y=b||0,this._width=c||0,this._height=d||0},TilingSprite.prototype.setFrame=function(a,b,c,d){this._frame.x=a,this._frame.y=b,this._frame.width=c,this._frame.height=d,this._refresh()},TilingSprite.prototype.updateTransform=function(){this.tilePosition.x=Math.round(-this.origin.x),this.tilePosition.y=Math.round(-this.origin.y),this.tilingTexture||(this.originalTexture=null,this.generateTilingTexture(!0)),PIXI.TilingSprite.prototype.updateTransform.call(this)},TilingSprite.prototype._onBitmapLoad=function(){this.texture.baseTexture=this._bitmap.baseTexture,this._refresh()},TilingSprite.prototype._refresh=function(){var a=this._frame.clone();0===a.width&&0===a.height&&this._bitmap&&(a.width=this._bitmap.width,a.height=this._bitmap.height);var b=this.texture.trim;this.texture.trim=a,this.texture.setFrame(a),this.texture.trim=b,this.tilingTexture=null},ScreenSprite.prototype=Object.create(PIXI.Sprite.prototype),ScreenSprite.prototype.constructor=ScreenSprite,ScreenSprite.prototype.initialize=function(){var a=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,a),this._bitmap=new Bitmap(1,1),this.texture.baseTexture=this._bitmap.baseTexture,this.texture.setFrame(new Rectangle(0,0,1,1)),this.scale.x=Graphics.width,this.scale.y=Graphics.height,this.opacity=0,this._red=-1,this._green=-1,this._blue=-1,this._colorText="",this.setBlack()},Object.defineProperty(ScreenSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0}),ScreenSprite.prototype.setBlack=function(){this.setColor(0,0,0)},ScreenSprite.prototype.setWhite=function(){this.setColor(255,255,255)},ScreenSprite.prototype.setColor=function(a,b,c){(this._red!==a||this._green!==b||this._blue!==c)&&(a=Math.round(a||0).clamp(0,255),b=Math.round(b||0).clamp(0,255),c=Math.round(c||0).clamp(0,255),this._red=a,this._green=b,this._blue=c,this._colorText=Utils.rgbToCssColor(a,b,c),this._bitmap.fillAll(this._colorText))},ScreenSprite.prototype._renderCanvas=function(a){if(this.visible&&this.alpha>0){var b=a.context,c=this.worldTransform,d=a.resolution;b.setTransform(c.a,c.b,c.c,c.d,c.tx*d,c.ty*d),b.globalCompositeOperation=PIXI.blendModesCanvas[this.blendMode],b.globalAlpha=this.alpha,b.fillStyle=this._colorText,b.fillRect(0,0,Graphics.width,Graphics.height)}},Window.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Window.prototype.constructor=Window,Window.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._isWindow=!0,this._windowskin=null,this._width=0,this._height=0,this._cursorRect=new Rectangle,this._openness=255,this._animationCount=0,this._padding=18,this._margin=4,this._colorTone=[0,0,0],this._windowSpriteContainer=null,this._windowBackSprite=null,this._windowCursorSprite=null,this._windowFrameSprite=null,this._windowContentsSprite=null,this._windowArrowSprites=[],this._windowPauseSignSprite=null,this._createAllParts(),this.origin=new Point,this.active=!0,this.downArrowVisible=!1,this.upArrowVisible=!1,this.pause=!1},Object.defineProperty(Window.prototype,"windowskin",{get:function(){return this._windowskin},set:function(a){this._windowskin!==a&&(this._windowskin=a,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))},configurable:!0}),Object.defineProperty(Window.prototype,"contents",{get:function(){return this._windowContentsSprite.bitmap},set:function(a){this._windowContentsSprite.bitmap=a},configurable:!0}),Object.defineProperty(Window.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"padding",{get:function(){return this._padding},set:function(a){this._padding=a,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"margin",{get:function(){return this._margin},set:function(a){this._margin=a,this._refreshAllParts()},configurable:!0}),Object.defineProperty(Window.prototype,"opacity",{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(a){this._windowSpriteContainer.alpha=a.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"backOpacity",{get:function(){return 255*this._windowBackSprite.alpha},set:function(a){this._windowBackSprite.alpha=a.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"contentsOpacity",{get:function(){return 255*this._windowContentsSprite.alpha},set:function(a){this._windowContentsSprite.alpha=a.clamp(0,255)/255},configurable:!0}),Object.defineProperty(Window.prototype,"openness",{get:function(){return this._openness},set:function(a){this._openness!==a&&(this._openness=a.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))},configurable:!0}),Window.prototype.update=function(){this.active&&this._animationCount++,this.children.forEach(function(a){a.update&&a.update()})},Window.prototype.move=function(a,b,c,d){this.x=a||0,this.y=b||0,(this._width!==c||this._height!==d)&&(this._width=c||0,this._height=d||0,this._refreshAllParts())},Window.prototype.isOpen=function(){return this._openness>=255},Window.prototype.isClosed=function(){return this._openness<=0},Window.prototype.setCursorRect=function(a,b,c,d){var e=Math.floor(a||0),f=Math.floor(b||0),g=Math.floor(c||0),h=Math.floor(d||0),i=this._cursorRect;(i.x!==e||i.y!==f||i.width!==g||i.height!==h)&&(this._cursorRect.x=e,this._cursorRect.y=f,this._cursorRect.width=g,this._cursorRect.height=h,this._refreshCursor())},Window.prototype.setTone=function(a,b,c){var d=this._colorTone;(a!==d[0]||b!==d[1]||c!==d[2])&&(this._colorTone=[a,b,c],this._refreshBack())},Window.prototype.addChildToBack=function(a){var b=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(a,b+1)},Window.prototype.updateTransform=function(){this._updateCursor(),this._updateArrows(),this._updatePauseSign(),this._updateContents(),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Window.prototype._createAllParts=function(){this._windowSpriteContainer=new PIXI.DisplayObjectContainer,this._windowBackSprite=new Sprite,this._windowCursorSprite=new Sprite,this._windowFrameSprite=new Sprite,this._windowContentsSprite=new Sprite,this._downArrowSprite=new Sprite,this._upArrowSprite=new Sprite,this._windowPauseSignSprite=new Sprite,this._windowBackSprite.bitmap=new Bitmap(1,1),this._windowBackSprite.alpha=192/255,this.addChild(this._windowSpriteContainer),this._windowSpriteContainer.addChild(this._windowBackSprite),this._windowSpriteContainer.addChild(this._windowFrameSprite),this.addChild(this._windowCursorSprite),this.addChild(this._windowContentsSprite),this.addChild(this._downArrowSprite),this.addChild(this._upArrowSprite),this.addChild(this._windowPauseSignSprite)},Window.prototype._onWindowskinLoad=function(){this._refreshAllParts()},Window.prototype._refreshAllParts=function(){this._refreshBack(),this._refreshFrame(),this._refreshCursor(),this._refreshContents(),this._refreshArrows(),this._refreshPauseSign()},Window.prototype._refreshBack=function(){var a=this._margin,b=this._width-2*a,c=this._height-2*a,d=new Bitmap(b,c);if(this._windowBackSprite.bitmap=d,this._windowBackSprite.setFrame(0,0,b,c),this._windowBackSprite.move(a,a),b>0&&c>0&&this._windowskin){var e=96;d.blt(this._windowskin,0,0,e,e,0,0,b,c);for(var f=0;c>f;f+=e)for(var g=0;b>g;g+=e)d.blt(this._windowskin,0,e,e,e,g,f,e,e);var h=this._colorTone;d.adjustTone(h[0],h[1],h[2])}},Window.prototype._refreshFrame=function(){var a=this._width,b=this._height,c=24,d=new Bitmap(a,b);if(this._windowFrameSprite.bitmap=d,this._windowFrameSprite.setFrame(0,0,a,b),a>0&&b>0&&this._windowskin){var e=this._windowskin,f=96,g=96;d.blt(e,f+c,0,f-2*c,c,c,0,a-2*c,c),d.blt(e,f+c,0+g-c,f-2*c,c,c,b-c,a-2*c,c),d.blt(e,f+0,0+c,c,f-2*c,0,c,c,b-2*c),d.blt(e,f+g-c,0+c,c,f-2*c,a-c,c,c,b-2*c),d.blt(e,f+0,0,c,c,0,0,c,c),d.blt(e,f+g-c,0,c,c,a-c,0,c,c),d.blt(e,f+0,0+g-c,c,c,0,b-c,c,c),d.blt(e,f+g-c,0+g-c,c,c,a-c,b-c,c,c)}},Window.prototype._refreshCursor=function(){var a=this._padding,b=this._cursorRect.x+a-this.origin.x,c=this._cursorRect.y+a-this.origin.y,d=this._cursorRect.width,e=this._cursorRect.height,f=4,g=Math.max(b,a),h=Math.max(c,a),i=b-g,j=c-h,k=Math.min(d,this._width-a-g),l=Math.min(e,this._height-a-h),m=new Bitmap(k,l);if(this._windowCursorSprite.bitmap=m,this._windowCursorSprite.setFrame(0,0,k,l),this._windowCursorSprite.move(g,h),d>0&&e>0&&this._windowskin){var n=this._windowskin,o=96,p=48;m.blt(n,o+f,o+f,p-2*f,p-2*f,i+f,j+f,d-2*f,e-2*f),m.blt(n,o+f,o+0,p-2*f,f,i+f,j+0,d-2*f,f),m.blt(n,o+f,o+p-f,p-2*f,f,i+f,j+e-f,d-2*f,f),m.blt(n,o+0,o+f,f,p-2*f,i+0,j+f,f,e-2*f),m.blt(n,o+p-f,o+f,f,p-2*f,i+d-f,j+f,f,e-2*f),m.blt(n,o+0,o+0,f,f,i+0,j+0,f,f),m.blt(n,o+p-f,o+0,f,f,i+d-f,j+0,f,f),m.blt(n,o+0,o+p-f,f,f,i+0,j+e-f,f,f),m.blt(n,o+p-f,o+p-f,f,f,i+d-f,j+e-f,f,f)}},Window.prototype._refreshContents=function(){this._windowContentsSprite.move(this.padding,this.padding)},Window.prototype._refreshArrows=function(){var a=this._width,b=this._height,c=24,d=c/2,e=96+c,f=0+c;this._downArrowSprite.bitmap=this._windowskin,this._downArrowSprite.anchor.x=.5,this._downArrowSprite.anchor.y=.5,this._downArrowSprite.setFrame(e+d,f+d+c,c,d),this._downArrowSprite.move(a/2,b-d),this._upArrowSprite.bitmap=this._windowskin,this._upArrowSprite.anchor.x=.5,this._upArrowSprite.anchor.y=.5,this._upArrowSprite.setFrame(e+d,f,c,d),this._upArrowSprite.move(a/2,d)},Window.prototype._refreshPauseSign=function(){var a=144,b=96,c=24;this._windowPauseSignSprite.bitmap=this._windowskin,this._windowPauseSignSprite.anchor.x=.5,this._windowPauseSignSprite.anchor.y=1,this._windowPauseSignSprite.move(this._width/2,this._height),this._windowPauseSignSprite.setFrame(a,b,c,c),this._windowPauseSignSprite.alpha=0},Window.prototype._updateCursor=function(){var a=this._animationCount%40,b=this.contentsOpacity;this.active&&(b-=20>a?8*a:8*(40-a)),this._windowCursorSprite.alpha=b/255,this._windowCursorSprite.visible=this.isOpen()},Window.prototype._updateContents=function(){var a=this._width-2*this._padding,b=this._height-2*this._padding;a>0&&b>0?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,a,b),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1},Window.prototype._updateArrows=function(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible,this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible},Window.prototype._updatePauseSign=function(){var a=this._windowPauseSignSprite,b=Math.floor(this._animationCount/16)%2,c=Math.floor(this._animationCount/16/2)%2,d=144,e=96,f=24;this.pause?a.alpha<1&&(a.alpha=Math.min(a.alpha+.1,1)):a.alpha=0,a.setFrame(d+b*f,e+c*f,f,f),a.visible=this.isOpen()},WindowLayer.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),WindowLayer.prototype.constructor=WindowLayer,WindowLayer.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._width=0,this._height=0,this._tempCanvas=null,this._vertexBuffer=null,this._translationMatrix=[1,0,0,0,1,0,0,0,1],this._dummySprite=new Sprite(new Bitmap(1,1))},Object.defineProperty(WindowLayer.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a},configurable:!0}),Object.defineProperty(WindowLayer.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a},configurable:!0}),WindowLayer.prototype.move=function(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d},WindowLayer.prototype.update=function(){this.children.forEach(function(a){a.update&&a.update()})},WindowLayer.prototype._renderCanvas=function(a){if(this.visible){this._tempCanvas||(this._tempCanvas=document.createElement("canvas")),this._tempCanvas.width=Graphics.width,this._tempCanvas.height=Graphics.height;var b=a.context,c=this._tempCanvas.getContext("2d");c.save(),c.clearRect(0,0,Graphics.width,Graphics.height),c.beginPath(),c.rect(this.x,this.y,this.width,this.height),c.closePath(),c.clip(),a.context=c;for(var d=0;d<this.children.length;d++){var e=this.children[d];e._isWindow&&e.visible&&e.openness>0&&(this._canvasClearWindowRect(a,e),c.save(),e._renderCanvas(a),c.restore())}c.restore(),a.context=b,a.context.setTransform(1,0,0,1,0,0),a.context.globalCompositeOperation="source-over",a.context.globalAlpha=1,a.context.drawImage(this._tempCanvas,0,0);for(var f=0;f<this.children.length;f++)this.children[f]._isWindow||this.children[f]._renderCanvas(a)}},WindowLayer.prototype._canvasClearWindowRect=function(a,b){var c=this.x+b.x,d=this.y+b.y+b.height/2*(1-b._openness/255),e=b.width,f=b.height*b._openness/255;
a.context.clearRect(c,d,e,f)},WindowLayer.prototype._renderWebGL=function(a){if(this.visible){var b=a.gl;this._vertexBuffer||(this._vertexBuffer=b.createBuffer()),this._dummySprite._renderWebGL(a),a.spriteBatch.stop(),b.enable(b.STENCIL_TEST),b.clear(b.STENCIL_BUFFER_BIT),this._webglMaskOutside(a),a.spriteBatch.start();for(var c=this.children.length-1;c>=0;c--){var d=this.children[c];d._isWindow&&d.visible&&d.openness>0&&(b.stencilFunc(b.EQUAL,0,255),d._renderWebGL(a),a.spriteBatch.stop(),this._webglMaskWindow(a,d),a.spriteBatch.start())}b.disable(b.STENCIL_TEST);for(var e=0;e<this.children.length;e++)this.children[e]._isWindow||this.children[e]._renderWebGL(a)}},WindowLayer.prototype._webglMaskOutside=function(a){var b=this.x,c=this.y,d=this.x+this.width,e=this.y+this.height;this._webglMaskRect(a,0,0,Graphics.width,c),this._webglMaskRect(a,0,e,Graphics.width,Graphics.height-e),this._webglMaskRect(a,0,0,b,Graphics.height),this._webglMaskRect(a,d,0,Graphics.width-d,Graphics.height)},WindowLayer.prototype._webglMaskWindow=function(a,b){var c=this.x+b.x,d=this.y+b.y+b.height/2*(1-b._openness/255),e=b.width,f=b.height*b._openness/255;this._webglMaskRect(a,c,d,e,f)},WindowLayer.prototype._webglMaskRect=function(a,b,c,d,e){if(d>0&&e>0){var f=a.gl,g=a.projection,h=a.offset,i=a.shaderManager.primitiveShader;a.shaderManager.setShader(i),f.uniformMatrix3fv(i.translationMatrix,!1,this._translationMatrix),f.uniform1f(i.flipY,1),f.uniform2f(i.projectionVector,g.x,-g.y),f.uniform2f(i.offsetVector,-h.x,-h.y),f.stencilFunc(f.EQUAL,0,255),f.stencilOp(f.KEEP,f.KEEP,f.INCR);var j=new Float32Array([b,c,b+d,c,b,c+e,b,c+e,b+d,c,b+d,c+e]);f.bindBuffer(f.ARRAY_BUFFER,this._vertexBuffer),f.bufferData(f.ARRAY_BUFFER,j,f.STATIC_DRAW),f.enableVertexAttribArray(i.aVertexPosition),f.vertexAttribPointer(i.aVertexPosition,2,f.FLOAT,!1,0,0),f.drawArrays(f.TRIANGLES,0,6),f.stencilOp(f.KEEP,f.KEEP,f.KEEP)}},Weather.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),Weather.prototype.constructor=Weather,Weather.prototype.initialize=function(){PIXI.DisplayObjectContainer.call(this),this._width=Graphics.width,this._height=Graphics.height,this._sprites=[],this._createBitmaps(),this._createDimmer(),this.type="none",this.power=0,this.origin=new Point},Weather.prototype.update=function(){this._updateDimmer(),this._updateAllSprites()},Weather.prototype._createBitmaps=function(){this._rainBitmap=new Bitmap(1,60),this._rainBitmap.fillAll("white"),this._stormBitmap=new Bitmap(2,100),this._stormBitmap.fillAll("white"),this._snowBitmap=new Bitmap(9,9),this._snowBitmap.drawCircle(4,4,4,"white")},Weather.prototype._createDimmer=function(){this._dimmerSprite=new ScreenSprite,this._dimmerSprite.setColor(80,80,80),this.addChild(this._dimmerSprite)},Weather.prototype._updateDimmer=function(){this._dimmerSprite.opacity=Math.floor(6*this.power)},Weather.prototype._updateAllSprites=function(){for(var a=Math.floor(10*this.power);this._sprites.length<a;)this._addSprite();for(;this._sprites.length>a;)this._removeSprite();this._sprites.forEach(function(a){this._updateSprite(a),a.x=a.ax-this.origin.x,a.y=a.ay-this.origin.y},this)},Weather.prototype._addSprite=function(){var a=new Sprite(this.viewport);a.opacity=0,this._sprites.push(a),this.addChild(a)},Weather.prototype._removeSprite=function(){this.removeChild(this._sprites.pop())},Weather.prototype._updateSprite=function(a){switch(this.type){case"rain":this._updateRainSprite(a);break;case"storm":this._updateStormSprite(a);break;case"snow":this._updateSnowSprite(a)}a.opacity<40&&this._rebornSprite(a)},Weather.prototype._updateRainSprite=function(a){a.bitmap=this._rainBitmap,a.rotation=Math.PI/16,a.ax-=6*Math.sin(a.rotation),a.ay+=6*Math.cos(a.rotation),a.opacity-=6},Weather.prototype._updateStormSprite=function(a){a.bitmap=this._stormBitmap,a.rotation=Math.PI/8,a.ax-=8*Math.sin(a.rotation),a.ay+=8*Math.cos(a.rotation),a.opacity-=8},Weather.prototype._updateSnowSprite=function(a){a.bitmap=this._snowBitmap,a.rotation=Math.PI/16,a.ax-=3*Math.sin(a.rotation),a.ay+=3*Math.cos(a.rotation),a.opacity-=3},Weather.prototype._rebornSprite=function(a){a.ax=Math.randomInt(Graphics.width+100)-100+this.origin.x,a.ay=Math.randomInt(Graphics.height+200)-200+this.origin.y,a.opacity=160+Math.randomInt(60)},ToneFilter.prototype=Object.create(PIXI.AbstractFilter.prototype),ToneFilter.prototype.constructor=ToneFilter,ToneFilter.prototype.initialize=function(){this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},ToneFilter.prototype.reset=function(){this.uniforms.matrix.value=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},ToneFilter.prototype.adjustHue=function(a){if(a=(a||0)/180,0!==a){var b=Math.cos(a*Math.PI),c=Math.sin(a*Math.PI),d=.213+.787*b-.213*c,e=.715-.715*b-.715*c,f=.072-.072*b+.928*c,g=.213-.213*b+.143*c,h=.715+.285*b+.14*c,i=.072-.072*b-.283*c,j=.213-.213*b-.787*c,k=.715-.715*b+.715*c,l=.072+.928*b+.072*c;this._multiplyMatrix([d,e,f,0,g,h,i,0,j,k,l,0,0,0,0,1])}},ToneFilter.prototype.adjustSaturation=function(a){if(a=(a||0).clamp(-255,255)/255,0!==a){var b=1+a,c=.213+.787*b,d=.715-.715*b,e=.072-.072*b,f=.213-.213*b,g=.715+.285*b,h=.072-.072*b,i=.213-.213*b,j=.715-.715*b,k=.072+.928*b;this._multiplyMatrix([c,d,e,0,f,g,h,0,i,j,k,0,0,0,0,1])}},ToneFilter.prototype.adjustTone=function(a,b,c){a=(a||0).clamp(-255,255)/255,b=(b||0).clamp(-255,255)/255,c=(c||0).clamp(-255,255)/255,(0!==a||0!==b||0!==c)&&this._multiplyMatrix([1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1])},ToneFilter.prototype._multiplyMatrix=function(a){for(var b=this.uniforms.matrix.value,c=[],d=0;4>d;d++){for(var e=0;4>e;e++)c[e]=b[4*d+e];for(var f=0;4>f;f++){for(var g=0,h=0;4>h;h++)g+=a[4*h+f]*c[h];b[4*d+f]=g}}},ToneSprite.prototype=Object.create(PIXI.DisplayObject.prototype),ToneSprite.prototype.constructor=ToneSprite,ToneSprite.prototype.initialize=function(){PIXI.DisplayObject.call(this),this.clear()},ToneSprite.prototype.clear=function(){this._red=0,this._green=0,this._blue=0,this._gray=0},ToneSprite.prototype.setTone=function(a,b,c,d){this._red=Math.round(a||0).clamp(-255,255),this._green=Math.round(b||0).clamp(-255,255),this._blue=Math.round(c||0).clamp(-255,255),this._gray=Math.round(d||0).clamp(0,255)},ToneSprite.prototype._renderCanvas=function(a){if(this.visible){var b=a.context,c=this.worldTransform,d=a.resolution,e=Graphics.width,f=Graphics.height;b.save(),b.setTransform(c.a,c.b,c.c,c.d,c.tx*d,c.ty*d),Graphics.canUseSaturationBlend()&&this._gray>0&&(b.globalCompositeOperation="saturation",b.globalAlpha=this._gray/255,b.fillStyle="#ffffff",b.fillRect(0,0,e,f)),b.globalAlpha=1;var g=Math.max(0,this._red),h=Math.max(0,this._green),i=Math.max(0,this._blue);if((g||h||i)&&(b.globalCompositeOperation="lighter",b.fillStyle=Utils.rgbToCssColor(g,h,i),b.fillRect(0,0,e,f)),Graphics.canUseDifferenceBlend()){var j=Math.max(0,-this._red),k=Math.max(0,-this._green),l=Math.max(0,-this._blue);(j||k||l)&&(b.globalCompositeOperation="difference",b.fillStyle="#ffffff",b.fillRect(0,0,e,f),b.globalCompositeOperation="lighter",b.fillStyle=Utils.rgbToCssColor(j,k,l),b.fillRect(0,0,e,f),b.globalCompositeOperation="difference",b.fillStyle="#ffffff",b.fillRect(0,0,e,f))}b.restore()}},ToneSprite.prototype._renderWebGL=function(a){},Stage.prototype=Object.create(PIXI.Stage.prototype),Stage.prototype.constructor=Stage,Stage.prototype.initialize=function(){PIXI.Stage.call(this),this.interactive=!1},WebAudio.prototype.initialize=function(a){WebAudio._initialized||WebAudio.initialize(),this.clear(),this._load(a),this._url=a},WebAudio._context=null,WebAudio._masterGainNode=null,WebAudio._initialized=!1,WebAudio._unlocked=!1,WebAudio.initialize=function(a){return this._initialized||(a||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0),!!this._context},WebAudio.canPlayOgg=function(){return this._initialized||this.initialize(),!!this._canPlayOgg},WebAudio.canPlayM4a=function(){return this._initialized||this.initialize(),!!this._canPlayM4a},WebAudio._createContext=function(){try{"undefined"!=typeof AudioContext?this._context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(a){this._context=null}},WebAudio._detectCodecs=function(){var a=document.createElement("audio");a.canPlayType&&(this._canPlayOgg=a.canPlayType("audio/ogg"),this._canPlayM4a=a.canPlayType("audio/mp4"))},WebAudio._createMasterGainNode=function(){var a=WebAudio._context;a&&(this._masterGainNode=a.createGain(),this._masterGainNode.gain.value=1,this._masterGainNode.connect(a.destination))},WebAudio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))},WebAudio._onTouchStart=function(){var a=WebAudio._context;if(a&&!this._unlocked){var b=a.createBufferSource();b.start(0),this._unlocked=!0}},WebAudio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},WebAudio._onHide=function(){this._shouldMuteOnHide()&&this._fadeOut(1)},WebAudio._onShow=function(){this._shouldMuteOnHide()&&this._fadeIn(.5)},WebAudio._shouldMuteOnHide=function(){return Utils.isMobileDevice()},WebAudio._fadeIn=function(a){if(this._masterGainNode){var b=this._masterGainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(b.value,c),b.linearRampToValueAtTime(1,c+a)}},WebAudio._fadeOut=function(a){if(this._masterGainNode){var b=this._masterGainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(b.value,c),b.linearRampToValueAtTime(0,c+a)}},WebAudio.prototype.clear=function(){this.stop(),this._buffer=null,this._sourceNode=null,this._gainNode=null,this._pannerNode=null,this._totalTime=0,this._sampleRate=0,this._loopStart=0,this._loopLength=0,this._startTime=0,this._volume=1,this._pitch=1,this._pan=0,this._endTimer=null,this._loadListeners=[],this._stopListeners=[],this._hasError=!1,this._autoPlay=!1},Object.defineProperty(WebAudio.prototype,"url",{get:function(){return this._url},configurable:!0}),Object.defineProperty(WebAudio.prototype,"volume",{get:function(){return this._volume},set:function(a){this._volume=a,this._gainNode&&(this._gainNode.gain.value=this._volume)},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pitch",{get:function(){return this._pitch},set:function(a){this._pitch!==a&&(this._pitch=a,this.isPlaying()&&this.play(this._sourceNode.loop,0))},configurable:!0}),Object.defineProperty(WebAudio.prototype,"pan",{get:function(){return this._pan},set:function(a){this._pan=a,this._updatePanner()},configurable:!0}),WebAudio.prototype.isReady=function(){return!!this._buffer},WebAudio.prototype.isError=function(){return this._hasError},WebAudio.prototype.isPlaying=function(){return!!this._sourceNode},WebAudio.prototype.play=function(a,b){this.isReady()?(b=b||0,this._startPlaying(a,b)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&this.play(a,b)}.bind(this)))},WebAudio.prototype.stop=function(){if(this._autoPlay=!1,this._removeEndTimer(),this._removeNodes(),this._stopListeners)for(;this._stopListeners.length>0;){var a=this._stopListeners.shift();a()}},WebAudio.prototype.fadeIn=function(a){if(this.isReady()){if(this._gainNode){var b=this._gainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(0,c),b.linearRampToValueAtTime(this._volume,c+a)}}else this._autoPlay&&this.addLoadListener(function(){this.fadeIn(a)}.bind(this))},WebAudio.prototype.fadeOut=function(a){if(this._gainNode){var b=this._gainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(b.value,c),b.linearRampToValueAtTime(0,c+a)}this._autoPlay=!1},WebAudio.prototype.seek=function(){if(WebAudio._context){var a=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(this._loopLength>0)for(;a>=this._loopStart+this._loopLength;)a-=this._loopLength;return a}return 0},WebAudio.prototype.addLoadListener=function(a){this._loadListeners.push(a)},WebAudio.prototype.addStopListener=function(a){this._stopListeners.push(a)},WebAudio.prototype._load=function(a){if(WebAudio._context){var b=new XMLHttpRequest;b.open("GET",a),b.responseType="arraybuffer",b.onload=function(){b.status<400&&this._onXhrLoad(b)}.bind(this),b.onerror=function(){this._hasError=!0}.bind(this),b.send()}},WebAudio.prototype._onXhrLoad=function(a){var b=new Uint8Array(a.response);this._readLoopComments(b),WebAudio._context.decodeAudioData(a.response,function(a){this._buffer=a,this._totalTime=a.duration,this._loopLength>0&&this._sampleRate>0?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime),this._onLoad()}.bind(this))},WebAudio.prototype._startPlaying=function(a,b){this._removeEndTimer(),this._removeNodes(),this._createNodes(),this._connectNodes(),this._sourceNode.loop=a,this._sourceNode.start(0,b),this._startTime=WebAudio._context.currentTime-b/this._pitch,this._createEndTimer()},WebAudio.prototype._createNodes=function(){var a=WebAudio._context;this._sourceNode=a.createBufferSource(),this._sourceNode.buffer=this._buffer,this._sourceNode.loopStart=this._loopStart,this._sourceNode.loopEnd=this._loopStart+this._loopLength,this._sourceNode.playbackRate.value=this._pitch,this._gainNode=a.createGain(),this._gainNode.gain.value=this._volume,this._pannerNode=a.createPanner(),this._pannerNode.panningModel="equalpower",this._updatePanner()},WebAudio.prototype._connectNodes=function(){this._sourceNode.connect(this._gainNode),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(WebAudio._masterGainNode)},WebAudio.prototype._removeNodes=function(){this._sourceNode&&(this._sourceNode.stop(0),this._sourceNode=null,this._gainNode=null,this._pannerNode=null)},WebAudio.prototype._createEndTimer=function(){if(this._sourceNode&&!this._sourceNode.loop){var a=this._startTime+this._totalTime/this._pitch,b=a-WebAudio._context.currentTime;this._endTimer=setTimeout(function(){this.stop()}.bind(this),1e3*b)}},WebAudio.prototype._removeEndTimer=function(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)},WebAudio.prototype._updatePanner=function(){if(this._pannerNode){var a=this._pan,b=1-Math.abs(a);this._pannerNode.setPosition(a,0,b)}},WebAudio.prototype._onLoad=function(){for(;this._loadListeners.length>0;){var a=this._loadListeners.shift();a()}},WebAudio.prototype._readLoopComments=function(a){this._readOgg(a),this._readMp4(a)},WebAudio.prototype._readOgg=function(a){for(var b=0;b<a.length&&"OggS"===this._readFourCharacters(a,b);){b+=26;for(var c=!1,d=a[b++],e=[],f=0;d>f;f++)e.push(a[b++]);for(f=0;d>f;f++){if("vorb"===this._readFourCharacters(a,b+1)){var g=a[b];1===g?this._sampleRate=this._readLittleEndian(a,b+12):3===g&&this._readMetaData(a,b,e[f]),c=!0}b+=e[f]}if(!c)break}},WebAudio.prototype._readMp4=function(a){if("ftyp"===this._readFourCharacters(a,4))for(var b=0;b<a.length;){var c=this._readBigEndian(a,b),d=this._readFourCharacters(a,b+4);if("moov"===d)b+=8;else if("mvhd"===d&&(this._sampleRate=this._readBigEndian(a,b+20)),("udta"===d||"meta"===d)&&this._readMetaData(a,b,c),b+=c,1>=c)break}},WebAudio.prototype._readMetaData=function(a,b,c){for(var d=b;b+c-10>d;d++)if("LOOP"===this._readFourCharacters(a,d)){for(var e="";a[d]>0;)e+=String.fromCharCode(a[d++]);if(e.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1)),e.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1)),"LOOPSTART"==e||"LOOPLENGTH"==e){var f="";for(d+=16;a[d]>0;)f+=String.fromCharCode(a[d++]);"LOOPSTART"==e?this._loopStart=parseInt(f):this._loopLength=parseInt(f)}}},WebAudio.prototype._readLittleEndian=function(a,b){return 16777216*a[b+3]+65536*a[b+2]+256*a[b+1]+a[b+0]},WebAudio.prototype._readBigEndian=function(a,b){return 16777216*a[b+0]+65536*a[b+1]+256*a[b+2]+a[b+3]},WebAudio.prototype._readFourCharacters=function(a,b){for(var c="",d=0;4>d;d++)c+=String.fromCharCode(a[b+d]);return c},Html5Audio._initialized=!1,Html5Audio._unlocked=!1,Html5Audio._audioElement=null,Html5Audio._gainTweenInterval=null,Html5Audio._tweenGain=0,Html5Audio._tweenTargetGain=0,Html5Audio._tweenGainStep=0,Html5Audio._staticSePath=null,Html5Audio.setup=function(a){this._initialized||this.initialize(),this.clear(),this._url=a},Html5Audio.initialize=function(){if(!this._initialized){if(!this._audioElement)try{this._audioElement=new Audio}catch(a){this._audioElement=null}this._audioElement&&this._setupEventHandlers(),this._initialized=!0}return!!this._audioElement},Html5Audio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this)),document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this)),this._audioElement.addEventListener("loadeddata",this._onLoadedData.bind(this)),this._audioElement.addEventListener("error",this._onError.bind(this)),this._audioElement.addEventListener("ended",this._onEnded.bind(this))},Html5Audio._onTouchStart=function(){this._audioElement&&!this._unlocked&&(this._isLoading?(this._load(this._url),this._unlocked=!0):this._staticSePath&&(this._audioElement.src=this._staticSePath,this._audioElement.volume=0,this._audioElement.loop=!1,this._audioElement.play(),this._unlocked=!0))},Html5Audio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()},Html5Audio._onLoadedData=function(){this._buffered=!0,this._unlocked&&this._onLoad()},Html5Audio._onError=function(){this._hasError=!0},Html5Audio._onEnded=function(){this._audioElement.loop||this.stop()},Html5Audio._onHide=function(){this._audioElement.volume=0,this._tweenGain=0},Html5Audio._onShow=function(){this.fadeIn(.5)},Html5Audio.clear=function(){this.stop(),this._volume=1,this._loadListeners=[],this._hasError=!1,this._autoPlay=!1,this._isLoading=!1,this._buffered=!1},Html5Audio.setStaticSe=function(a){this._initialized||(this.initialize(),this.clear()),this._staticSePath=a},Object.defineProperty(Html5Audio,"url",{get:function(){return Html5Audio._url},configurable:!0}),Object.defineProperty(Html5Audio,"volume",{get:function(){return Html5Audio._volume}.bind(this),set:function(a){Html5Audio._volume=a,Html5Audio._audioElement&&(Html5Audio._audioElement.volume=this._volume)},configurable:!0}),Html5Audio.isReady=function(){return this._buffered},Html5Audio.isError=function(){return this._hasError},Html5Audio.isPlaying=function(){return!this._audioElement.paused},Html5Audio.play=function(a,b){this.isReady()?(b=b||0,this._startPlaying(a,b)):Html5Audio._audioElement&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&(this.play(a,b),this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null))}.bind(this)),this._isLoading||this._load(this._url))},Html5Audio.stop=function(){this._audioElement&&this._audioElement.pause(),this._autoPlay=!1,this._tweenInterval&&(clearInterval(this._tweenInterval),this._tweenInterval=null,this._audioElement.volume=0)},Html5Audio.fadeIn=function(a){this.isReady()?this._audioElement&&(this._tweenTargetGain=this._volume,this._tweenGain=0,this._startGainTween(a)):this._autoPlay&&this.addLoadListener(function(){this.fadeIn(a)}.bind(this))},Html5Audio.fadeOut=function(a){this._audioElement&&(this._tweenTargetGain=0,this._tweenGain=this._volume,this._startGainTween(a))},Html5Audio.seek=function(){return this._audioElement?this._audioElement.currentTime:0},Html5Audio.addLoadListener=function(a){this._loadListeners.push(a)},Html5Audio._load=function(a){this._audioElement&&(this._isLoading=!0,this._audioElement.src=a,this._audioElement.load())},Html5Audio._startPlaying=function(a,b){this._audioElement.loop=a,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._audioElement&&(this._audioElement.volume=this._volume,this._audioElement.currentTime=b,this._audioElement.play())},Html5Audio._onLoad=function(){for(this._isLoading=!1;this._loadListeners.length>0;){var a=this._loadListeners.shift();a()}},Html5Audio._startGainTween=function(a){this._audioElement.volume=this._tweenGain,this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null),this._tweenGainStep=(this._tweenTargetGain-this._tweenGain)/(60*a),this._gainTweenInterval=setInterval(function(){Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain)},1e3/60)},Html5Audio._applyTweenValue=function(a){Html5Audio._tweenGain+=Html5Audio._tweenGainStep,Html5Audio._tweenGain<0&&Html5Audio._tweenGainStep<0?Html5Audio._tweenGain=0:Html5Audio._tweenGain>a&&Html5Audio._tweenGainStep>0&&(Html5Audio._tweenGain=a),Math.abs(Html5Audio._tweenTargetGain-Html5Audio._tweenGain)<.01&&(Html5Audio._tweenGain=Html5Audio._tweenTargetGain,clearInterval(Html5Audio._gainTweenInterval),Html5Audio._gainTweenInterval=null),Html5Audio._audioElement.volume=Html5Audio._tweenGain},JsonEx.maxDepth=100,JsonEx.stringify=function(a){return JSON.stringify(this._encode(a))},JsonEx.parse=function(a){return this._decode(JSON.parse(a))},JsonEx.makeDeepCopy=function(a){return this.parse(this.stringify(a))},JsonEx._encode=function(a,b){if(b=b||0,++b>=this.maxDepth)throw new Error("Object too deep");var c=Object.prototype.toString.call(a);if("[object Object]"===c||"[object Array]"===c){var d=this._getConstructorName(a);"Object"!==d&&"Array"!==d&&(a["@"]=d);for(var e in a)a.hasOwnProperty(e)&&(a[e]=this._encode(a[e],b+1))}return b--,a},JsonEx._decode=function(a){var b=Object.prototype.toString.call(a);if("[object Object]"===b||"[object Array]"===b){if(a["@"]){var c=window[a["@"]];c&&(a=this._resetPrototype(a,c.prototype))}for(var d in a)a.hasOwnProperty(d)&&(a[d]=this._decode(a[d]))}return a},JsonEx._getConstructorName=function(a){var b=a.constructor.name;if(void 0===b){var c=/^\s*function\s*([A-Za-z0-9_$]*)/;b=c.exec(a.constructor)[1]}return b},JsonEx._resetPrototype=function(a,b){if(void 0!==Object.setPrototypeOf)Object.setPrototypeOf(a,b);else if("__proto__"in a)a.__proto__=b;else{var c=Object.create(b);for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);a=c}return a};