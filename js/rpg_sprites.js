function Sprite_Base(){this.initialize.apply(this,arguments)}function Sprite_Button(){this.initialize.apply(this,arguments)}function Sprite_Character(){this.initialize.apply(this,arguments)}function Sprite_Battler(){this.initialize.apply(this,arguments)}function Sprite_Actor(){this.initialize.apply(this,arguments)}function Sprite_Enemy(){this.initialize.apply(this,arguments)}function Sprite_Animation(){this.initialize.apply(this,arguments)}function Sprite_Damage(){this.initialize.apply(this,arguments)}function Sprite_StateIcon(){this.initialize.apply(this,arguments)}function Sprite_StateOverlay(){this.initialize.apply(this,arguments)}function Sprite_Weapon(){this.initialize.apply(this,arguments)}function Sprite_Balloon(){this.initialize.apply(this,arguments)}function Sprite_Picture(){this.initialize.apply(this,arguments)}function Sprite_Timer(){this.initialize.apply(this,arguments)}function Sprite_Destination(){this.initialize.apply(this,arguments)}function Spriteset_Base(){this.initialize.apply(this,arguments)}function Spriteset_Map(){this.initialize.apply(this,arguments)}function Spriteset_Battle(){this.initialize.apply(this,arguments)}Sprite_Base.prototype=Object.create(Sprite.prototype),Sprite_Base.prototype.constructor=Sprite_Base,Sprite_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._animationSprites=[],this._effectTarget=this,this._hiding=!1},Sprite_Base.prototype.update=function(){Sprite.prototype.update.call(this),this.updateVisibility(),this.updateAnimationSprites()},Sprite_Base.prototype.hide=function(){this._hiding=!0,this.updateVisibility()},Sprite_Base.prototype.show=function(){this._hiding=!1,this.updateVisibility()},Sprite_Base.prototype.updateVisibility=function(){this.visible=!this._hiding},Sprite_Base.prototype.updateAnimationSprites=function(){if(this._animationSprites.length>0){var a=this._animationSprites.clone();this._animationSprites=[];for(var b=0;b<a.length;b++){var c=a[b];c.isPlaying()?this._animationSprites.push(c):c.remove()}}},Sprite_Base.prototype.startAnimation=function(a,b,c){var d=new Sprite_Animation;d.setup(this._effectTarget,a,b,c),this.parent.addChild(d),this._animationSprites.push(d)},Sprite_Base.prototype.isAnimationPlaying=function(){return this._animationSprites.length>0},Sprite_Button.prototype=Object.create(Sprite.prototype),Sprite_Button.prototype.constructor=Sprite_Button,Sprite_Button.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._touching=!1,this._coldFrame=null,this._hotFrame=null,this._clickHandler=null},Sprite_Button.prototype.update=function(){Sprite.prototype.update.call(this),this.updateFrame(),this.processTouch()},Sprite_Button.prototype.updateFrame=function(){var a;a=this._touching?this._hotFrame:this._coldFrame,a&&this.setFrame(a.x,a.y,a.width,a.height)},Sprite_Button.prototype.setColdFrame=function(a,b,c,d){this._coldFrame=new Rectangle(a,b,c,d)},Sprite_Button.prototype.setHotFrame=function(a,b,c,d){this._hotFrame=new Rectangle(a,b,c,d)},Sprite_Button.prototype.setClickHandler=function(a){this._clickHandler=a},Sprite_Button.prototype.callClickHandler=function(){this._clickHandler&&this._clickHandler()},Sprite_Button.prototype.processTouch=function(){this.isActive()?(TouchInput.isTriggered()&&this.isButtonTouched()&&(this._touching=!0),this._touching&&(TouchInput.isReleased()||!this.isButtonTouched())&&(this._touching=!1,TouchInput.isReleased()&&this.callClickHandler())):this._touching=!1},Sprite_Button.prototype.isActive=function(){for(var a=this;a;){if(!a.visible)return!1;a=a.parent}return!0},Sprite_Button.prototype.isButtonTouched=function(){var a=this.canvasToLocalX(TouchInput.x),b=this.canvasToLocalY(TouchInput.y);return a>=0&&b>=0&&a<this.width&&b<this.height},Sprite_Button.prototype.canvasToLocalX=function(a){for(var b=this;b;)a-=b.x,b=b.parent;return a},Sprite_Button.prototype.canvasToLocalY=function(a){for(var b=this;b;)a-=b.y,b=b.parent;return a},Sprite_Character.prototype=Object.create(Sprite_Base.prototype),Sprite_Character.prototype.constructor=Sprite_Character,Sprite_Character.prototype.initialize=function(a){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.setCharacter(a)},Sprite_Character.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._character=null,this._balloonDuration=0,this._tilesetId=0,this._upperBody=null,this._lowerBody=null},Sprite_Character.prototype.setCharacter=function(a){this._character=a},Sprite_Character.prototype.update=function(){Sprite_Base.prototype.update.call(this),this.updateBitmap(),this.updateFrame(),this.updatePosition(),this.updateAnimation(),this.updateBalloon(),this.updateOther()},Sprite_Character.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this),this._character.isTransparent()&&(this.visible=!1)},Sprite_Character.prototype.isTile=function(){return this._character.tileId>0},Sprite_Character.prototype.tilesetBitmap=function(a){var b=$gameMap.tileset(),c=5+Math.floor(a/256);return ImageManager.loadTileset(b.tilesetNames[c])},Sprite_Character.prototype.updateBitmap=function(){this.isImageChanged()&&(this._tilesetId=$gameMap.tilesetId(),this._tileId=this._character.tileId(),this._characterName=this._character.characterName(),this._characterIndex=this._character.characterIndex(),this._tileId>0?this.setTileBitmap():this.setCharacterBitmap())},Sprite_Character.prototype.isImageChanged=function(){return this._tilesetId!==$gameMap.tilesetId()||this._tileId!==this._character.tileId()||this._characterName!==this._character.characterName()||this._characterIndex!==this._character.characterIndex()},Sprite_Character.prototype.setTileBitmap=function(){this.bitmap=this.tilesetBitmap(this._tileId)},Sprite_Character.prototype.setCharacterBitmap=function(){this.bitmap=ImageManager.loadCharacter(this._characterName),this._isBigCharacter=ImageManager.isBigCharacter(this._characterName)},Sprite_Character.prototype.updateFrame=function(){this._tileId>0?this.updateTileFrame():this.updateCharacterFrame()},Sprite_Character.prototype.updateTileFrame=function(){var a=this.patternWidth(),b=this.patternHeight(),c=(Math.floor(this._tileId/128)%2*8+this._tileId%8)*a,d=Math.floor(this._tileId%256/8)%16*b;this.setFrame(c,d,a,b)},Sprite_Character.prototype.updateCharacterFrame=function(){var a=this.patternWidth(),b=this.patternHeight(),c=(this.characterBlockX()+this.characterPatternX())*a,d=(this.characterBlockY()+this.characterPatternY())*b;if(this.updateHalfBodySprites(),this._bushDepth>0){var e=this._bushDepth;this._upperBody.setFrame(c,d,a,b-e),this._lowerBody.setFrame(c,d+b-e,a,e),this.setFrame(c,d,0,b)}else this.setFrame(c,d,a,b)},Sprite_Character.prototype.characterBlockX=function(){if(this._isBigCharacter)return 0;var a=this._character.characterIndex();return a%4*3},Sprite_Character.prototype.characterBlockY=function(){if(this._isBigCharacter)return 0;var a=this._character.characterIndex();return 4*Math.floor(a/4)},Sprite_Character.prototype.characterPatternX=function(){return this._character.pattern()},Sprite_Character.prototype.characterPatternY=function(){return(this._character.direction()-2)/2},Sprite_Character.prototype.patternWidth=function(){return this._tileId>0?$gameMap.tileWidth():this._isBigCharacter?this.bitmap.width/3:this.bitmap.width/12},Sprite_Character.prototype.patternHeight=function(){return this._tileId>0?$gameMap.tileHeight():this._isBigCharacter?this.bitmap.height/4:this.bitmap.height/8},Sprite_Character.prototype.updateHalfBodySprites=function(){this._bushDepth>0?(this.createHalfBodySprites(),this._upperBody.bitmap=this.bitmap,this._upperBody.visible=!0,this._upperBody.y=-this._bushDepth,this._lowerBody.bitmap=this.bitmap,this._lowerBody.visible=!0,this._upperBody.setBlendColor(this.getBlendColor()),this._lowerBody.setBlendColor(this.getBlendColor()),this._upperBody.setColorTone(this.getColorTone()),this._lowerBody.setColorTone(this.getColorTone())):this._upperBody&&(this._upperBody.visible=!1,this._lowerBody.visible=!1)},Sprite_Character.prototype.createHalfBodySprites=function(){this._upperBody||(this._upperBody=new Sprite,this._upperBody.anchor.x=.5,this._upperBody.anchor.y=1,this.addChild(this._upperBody)),this._lowerBody||(this._lowerBody=new Sprite,this._lowerBody.anchor.x=.5,this._lowerBody.anchor.y=1,this._lowerBody.opacity=128,this.addChild(this._lowerBody))},Sprite_Character.prototype.updatePosition=function(){this.x=this._character.screenX(),this.y=this._character.screenY(),this.z=this._character.screenZ()},Sprite_Character.prototype.updateAnimation=function(){this.setupAnimation(),this.isAnimationPlaying()||this._character.endAnimation(),this.isBalloonPlaying()||this._character.endBalloon()},Sprite_Character.prototype.updateOther=function(){this.opacity=this._character.opacity(),this.blendMode=this._character.blendMode(),this._bushDepth=this._character.bushDepth()},Sprite_Character.prototype.setupAnimation=function(){if(this._character.animationId()>0){var a=$dataAnimations[this._character.animationId()];this.startAnimation(a,!1,0),this._character.startAnimation()}},Sprite_Character.prototype.setupBalloon=function(){this._character.balloonId()>0&&(this.startBalloon(),this._character.startBalloon())},Sprite_Character.prototype.startBalloon=function(){this._balloonSprite||(this._balloonSprite=new Sprite_Balloon),this._balloonSprite.setup(this._character.balloonId()),this.parent.addChild(this._balloonSprite)},Sprite_Character.prototype.updateBalloon=function(){this.setupBalloon(),this._balloonSprite&&(this._balloonSprite.x=this.x,this._balloonSprite.y=this.y-this.height,this._balloonSprite.isPlaying()||this.endBalloon())},Sprite_Character.prototype.endBalloon=function(){this._balloonSprite&&(this.parent.removeChild(this._balloonSprite),this._balloonSprite=null)},Sprite_Character.prototype.isBalloonPlaying=function(){return!!this._balloonSprite},Sprite_Battler.prototype=Object.create(Sprite_Base.prototype),Sprite_Battler.prototype.constructor=Sprite_Battler,Sprite_Battler.prototype.initialize=function(a){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.setBattler(a)},Sprite_Battler.prototype.initMembers=function(){this.anchor.x=.5,this.anchor.y=1,this._battler=null,this._damages=[],this._homeX=0,this._homeY=0,this._offsetX=0,this._offsetY=0,this._targetOffsetX=NaN,this._targetOffsetY=NaN,this._movementDuration=0,this._selectionEffectCount=0},Sprite_Battler.prototype.setBattler=function(a){this._battler=a},Sprite_Battler.prototype.setHome=function(a,b){this._homeX=a,this._homeY=b,this.updatePosition()},Sprite_Battler.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._battler?(this.updateMain(),this.updateAnimation(),this.updateDamagePopup(),this.updateSelectionEffect()):this.bitmap=null},Sprite_Battler.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this),this._battler&&this._battler.isSpriteVisible()||(this.visible=!1)},Sprite_Battler.prototype.updateMain=function(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame()),this.updateMove(),this.updatePosition()},Sprite_Battler.prototype.updateBitmap=function(){},Sprite_Battler.prototype.updateFrame=function(){},Sprite_Battler.prototype.updateMove=function(){if(this._movementDuration>0){var a=this._movementDuration;this._offsetX=(this._offsetX*(a-1)+this._targetOffsetX)/a,this._offsetY=(this._offsetY*(a-1)+this._targetOffsetY)/a,this._movementDuration--,0===this._movementDuration&&this.onMoveEnd()}},Sprite_Battler.prototype.updatePosition=function(){this.x=this._homeX+this._offsetX,this.y=this._homeY+this._offsetY},Sprite_Battler.prototype.updateAnimation=function(){this.setupAnimation()},Sprite_Battler.prototype.updateDamagePopup=function(){if(this.setupDamagePopup(),this._damages.length>0){for(var a=0;a<this._damages.length;a++)this._damages[a].update();this._damages[0].isPlaying()||(this.parent.removeChild(this._damages[0]),this._damages.shift())}},Sprite_Battler.prototype.updateSelectionEffect=function(){var a=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,this._selectionEffectCount%30<15?a.setBlendColor([255,255,255,64]):a.setBlendColor([0,0,0,0])):this._selectionEffectCount>0&&(this._selectionEffectCount=0,a.setBlendColor([0,0,0,0]))},Sprite_Battler.prototype.setupAnimation=function(){for(;this._battler.isAnimationRequested();){var a=this._battler.shiftAnimation(),b=$dataAnimations[a.animationId],c=a.mirror,d=3===b.position?0:a.delay;this.startAnimation(b,c,d);for(var e=0;e<this._animationSprites.length;e++){var f=this._animationSprites[e];f.visible=this._battler.isSpriteVisible()}}},Sprite_Battler.prototype.setupDamagePopup=function(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){var a=new Sprite_Damage;a.x=this.x+this.damageOffsetX(),a.y=this.y+this.damageOffsetY(),a.setup(this._battler),this._damages.push(a),this.parent.addChild(a)}this._battler.clearDamagePopup(),this._battler.clearResult()}},Sprite_Battler.prototype.damageOffsetX=function(){return 0},Sprite_Battler.prototype.damageOffsetY=function(){return 0},Sprite_Battler.prototype.startMove=function(a,b,c){(this._targetOffsetX!==a||this._targetOffsetY!==b)&&(this._targetOffsetX=a,this._targetOffsetY=b,this._movementDuration=c,0===c&&(this._offsetX=a,this._offsetY=b))},Sprite_Battler.prototype.onMoveEnd=function(){},Sprite_Battler.prototype.isEffecting=function(){return!1},Sprite_Battler.prototype.isMoving=function(){return this._movementDuration>0},Sprite_Battler.prototype.inHomePosition=function(){return 0===this._offsetX&&0===this._offsetY},Sprite_Actor.prototype=Object.create(Sprite_Battler.prototype),Sprite_Actor.prototype.constructor=Sprite_Actor,Sprite_Actor.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}},Sprite_Actor.prototype.initialize=function(a){Sprite_Battler.prototype.initialize.call(this,a),this.moveToStartPosition()},Sprite_Actor.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._battlerName="",this._motion=null,this._motionCount=0,this._pattern=0,this.createShadowSprite(),this.createWeaponSprite(),this.createMainSprite(),this.createStateSprite()},Sprite_Actor.prototype.createMainSprite=function(){this._mainSprite=new Sprite_Base,this._mainSprite.anchor.x=.5,this._mainSprite.anchor.y=1,this.addChild(this._mainSprite),this._effectTarget=this._mainSprite},Sprite_Actor.prototype.createShadowSprite=function(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow2"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=.5,this._shadowSprite.y=-2,this.addChild(this._shadowSprite)},Sprite_Actor.prototype.createWeaponSprite=function(){this._weaponSprite=new Sprite_Weapon,this.addChild(this._weaponSprite)},Sprite_Actor.prototype.createStateSprite=function(){this._stateSprite=new Sprite_StateOverlay,this.addChild(this._stateSprite)},Sprite_Actor.prototype.setBattler=function(a){Sprite_Battler.prototype.setBattler.call(this,a);var b=a!==this._actor;b&&(this._actor=a,a&&this.setActorHome(a.index()),this.startEntryMotion(),this._stateSprite.setup(a))},Sprite_Actor.prototype.moveToStartPosition=function(){this.startMove(300,0,0)},Sprite_Actor.prototype.setActorHome=function(a){this.setHome(600+32*a,280+48*a)},Sprite_Actor.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this.updateShadow(),this._actor&&this.updateMotion()},Sprite_Actor.prototype.updateShadow=function(){this._shadowSprite.visible=!!this._actor},Sprite_Actor.prototype.updateMain=function(){Sprite_Battler.prototype.updateMain.call(this),this._actor.isSpriteVisible()&&!this.isMoving()&&this.updateTargetPosition()},Sprite_Actor.prototype.setupMotion=function(){this._actor.isMotionRequested()&&(this.startMotion(this._actor.motionType()),this._actor.clearMotion())},Sprite_Actor.prototype.setupWeaponAnimation=function(){this._actor.isWeaponAnimationRequested()&&(this._weaponSprite.setup(this._actor.weaponImageId()),this._actor.clearWeaponAnimation())},Sprite_Actor.prototype.startMotion=function(a){var b=Sprite_Actor.MOTIONS[a];this._motion!==b&&(this._motion=b,this._motionCount=0,this._pattern=0)},Sprite_Actor.prototype.updateTargetPosition=function(){this._actor.isInputting()||this._actor.isActing()?this.stepForward():this._actor.canMove()&&BattleManager.isEscaped()?this.retreat():this.inHomePosition()||this.stepBack()},Sprite_Actor.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var a=this._actor.battlerName();this._battlerName!==a&&(this._battlerName=a,this._mainSprite.bitmap=ImageManager.loadSvActor(a))},Sprite_Actor.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);var a=this._mainSprite.bitmap;if(a){var b=this._motion?this._motion.index:0,c=this._pattern<3?this._pattern:1,d=a.width/9,e=a.height/6,f=3*Math.floor(b/6)+c,g=b%6;this._mainSprite.setFrame(f*d,g*e,d,e)}},Sprite_Actor.prototype.updateMove=function(){var a=this._mainSprite.bitmap;(!a||a.isReady())&&Sprite_Battler.prototype.updateMove.call(this)},Sprite_Actor.prototype.updateMotion=function(){this.setupMotion(),this.setupWeaponAnimation(),this._actor.isMotionRefreshRequested()&&(this.refreshMotion(),this._actor.clearMotion()),this.updateMotionCount()},Sprite_Actor.prototype.updateMotionCount=function(){this._motion&&++this._motionCount>=this.motionSpeed()&&(this._motion.loop?this._pattern=(this._pattern+1)%4:this._pattern<2?this._pattern++:this.refreshMotion(),this._motionCount=0)},Sprite_Actor.prototype.motionSpeed=function(){return 12},Sprite_Actor.prototype.refreshMotion=function(){var a=this._actor;if(a){var b=a.stateMotionIndex();a.isInputting()||a.isActing()?this.startMotion("walk"):3===b?this.startMotion("dead"):2===b?this.startMotion("sleep"):a.isChanting()?this.startMotion("chant"):a.isGuard()||a.isGuardWaiting()?this.startMotion("guard"):1===b?this.startMotion("abnormal"):a.isDying()?this.startMotion("dying"):a.isUndecided()?this.startMotion("walk"):this.startMotion("wait")}},Sprite_Actor.prototype.startEntryMotion=function(){this._actor&&this._actor.canMove()?(this.startMotion("walk"),this.startMove(0,0,30)):this.isMoving()||(this.refreshMotion(),this.startMove(0,0,0))},Sprite_Actor.prototype.stepForward=function(){this.startMove(-48,0,12)},Sprite_Actor.prototype.stepBack=function(){this.startMove(0,0,12)},Sprite_Actor.prototype.retreat=function(){this.startMove(300,0,30)},Sprite_Actor.prototype.onMoveEnd=function(){Sprite_Battler.prototype.onMoveEnd.call(this),BattleManager.isBattleEnd()||this.refreshMotion()},Sprite_Actor.prototype.damageOffsetX=function(){return-32},Sprite_Actor.prototype.damageOffsetY=function(){return 0},Sprite_Enemy.prototype=Object.create(Sprite_Battler.prototype),Sprite_Enemy.prototype.constructor=Sprite_Enemy,Sprite_Enemy.prototype.initialize=function(a){Sprite_Battler.prototype.initialize.call(this,a)},Sprite_Enemy.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this),this._enemy=null,this._appeared=!1,this._battlerName="",this._battlerHue=0,this._effectType=null,this._effectDuration=0,this._shake=0,this.createStateIconSprite()},Sprite_Enemy.prototype.createStateIconSprite=function(){this._stateIconSprite=new Sprite_StateIcon,this.addChild(this._stateIconSprite)},Sprite_Enemy.prototype.setBattler=function(a){Sprite_Battler.prototype.setBattler.call(this,a),this._enemy=a,this.setHome(a.screenX(),a.screenY()),this._stateIconSprite.setup(a)},Sprite_Enemy.prototype.update=function(){Sprite_Battler.prototype.update.call(this),this._enemy&&(this.updateEffect(),this.updateStateSprite())},Sprite_Enemy.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var a=this._enemy.battlerName(),b=this._enemy.battlerHue();(this._battlerName!==a||this._battlerHue!==b)&&(this._battlerName=a,this._battlerHue=b,this.loadBitmap(a,b),this.initVisibility())},Sprite_Enemy.prototype.loadBitmap=function(a,b){$gameSystem.isSideView()?this.bitmap=ImageManager.loadSvEnemy(a,b):this.bitmap=ImageManager.loadEnemy(a,b)},Sprite_Enemy.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);var a=this.bitmap.height;"bossCollapse"===this._effectType&&(a=this._effectDuration),this.setFrame(0,0,this.bitmap.width,a)},Sprite_Enemy.prototype.updatePosition=function(){Sprite_Battler.prototype.updatePosition.call(this),this.x+=this._shake},Sprite_Enemy.prototype.updateStateSprite=function(){this._stateIconSprite.y=-Math.round(.9*(this.bitmap.height+40)),this._stateIconSprite.y<20-this.y&&(this._stateIconSprite.y=20-this.y)},Sprite_Enemy.prototype.initVisibility=function(){this._appeared=this._enemy.isAlive(),this._appeared||(this.opacity=0)},Sprite_Enemy.prototype.setupEffect=function(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect()),!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")},Sprite_Enemy.prototype.startEffect=function(a){switch(this._effectType=a,this._effectType){case"appear":this.startAppear();break;case"disappear":this.startDisappear();break;case"whiten":this.startWhiten();break;case"blink":this.startBlink();break;case"collapse":this.startCollapse();break;case"bossCollapse":this.startBossCollapse();break;case"instantCollapse":this.startInstantCollapse()}this.revertToNormal()},Sprite_Enemy.prototype.startAppear=function(){this._effectDuration=16,this._appeared=!0},Sprite_Enemy.prototype.startDisappear=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startWhiten=function(){this._effectDuration=16},Sprite_Enemy.prototype.startBlink=function(){this._effectDuration=20},Sprite_Enemy.prototype.startCollapse=function(){this._effectDuration=32,this._appeared=!1},Sprite_Enemy.prototype.startBossCollapse=function(){this._effectDuration=this.bitmap.height,this._appeared=!1},Sprite_Enemy.prototype.startInstantCollapse=function(){this._effectDuration=16,this._appeared=!1},Sprite_Enemy.prototype.updateEffect=function(){if(this.setupEffect(),this._effectDuration>0){switch(this._effectDuration--,this._effectType){case"whiten":this.updateWhiten();break;case"blink":this.updateBlink();break;case"appear":this.updateAppear();break;case"disappear":this.updateDisappear();break;case"collapse":this.updateCollapse();break;case"bossCollapse":this.updateBossCollapse();break;case"instantCollapse":this.updateInstantCollapse()}0===this._effectDuration&&(this._effectType=null)}},Sprite_Enemy.prototype.isEffecting=function(){return null!==this._effectType},Sprite_Enemy.prototype.revertToNormal=function(){this._shake=0,this.blendMode=0,this.opacity=255,this.setBlendColor([0,0,0,0])},Sprite_Enemy.prototype.updateWhiten=function(){var a=128-10*(16-this._effectDuration);this.setBlendColor([255,255,255,a])},Sprite_Enemy.prototype.updateBlink=function(){this.opacity=this._effectDuration%10<5?255:0},Sprite_Enemy.prototype.updateAppear=function(){this.opacity=16*(16-this._effectDuration)},Sprite_Enemy.prototype.updateDisappear=function(){this.opacity=256-10*(32-this._effectDuration)},Sprite_Enemy.prototype.updateCollapse=function(){this.blendMode=Graphics.BLEND_ADD,this.setBlendColor([255,128,128,128]),this.opacity*=this._effectDuration/(this._effectDuration+1)},Sprite_Enemy.prototype.updateBossCollapse=function(){this._shake=this._effectDuration%2*4-2,this.blendMode=Graphics.BLEND_ADD,this.opacity*=this._effectDuration/(this._effectDuration+1),this.setBlendColor([255,255,255,255-this.opacity]),this._effectDuration%20===19&&SoundManager.playBossCollapse2()},Sprite_Enemy.prototype.updateInstantCollapse=function(){this.opacity=0},Sprite_Enemy.prototype.damageOffsetX=function(){return 0},Sprite_Enemy.prototype.damageOffsetY=function(){return-8},Sprite_Animation.prototype=Object.create(Sprite.prototype),Sprite_Animation.prototype.constructor=Sprite_Animation,Sprite_Animation._checker1={},Sprite_Animation._checker2={},Sprite_Animation.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.initMembers()},Sprite_Animation.prototype.initMembers=function(){this._target=null,this._animation=null,this._mirror=!1,this._delay=0,this._rate=4,this._duration=0,this._flashColor=[0,0,0,0],this._flashDuration=0,this._screenFlashDuration=0,this._hidingDuration=0,this._bitmap1=null,this._bitmap2=null,this._cellSprites=[],this._screenFlashSprite=null,this._duplicated=!1,this.z=8},Sprite_Animation.prototype.setup=function(a,b,c,d){this._target=a,this._animation=b,this._mirror=c,this._delay=d,this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())},Sprite_Animation.prototype.remove=function(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())},Sprite_Animation.prototype.setupRate=function(){this._rate=4},Sprite_Animation.prototype.setupDuration=function(){this._duration=this._animation.frames.length*this._rate+1},Sprite_Animation.prototype.update=function(){Sprite.prototype.update.call(this),this.updateMain(),this.updateFlash(),this.updateScreenFlash(),this.updateHiding(),Sprite_Animation._checker1={},Sprite_Animation._checker2={}},Sprite_Animation.prototype.updateFlash=function(){if(this._flashDuration>0){var a=this._flashDuration--;this._flashColor[3]*=(a-1)/a,this._target.setBlendColor(this._flashColor)}},Sprite_Animation.prototype.updateScreenFlash=function(){if(this._screenFlashDuration>0){var a=this._screenFlashDuration--;this._screenFlashSprite&&(this._screenFlashSprite.x=-this.absoluteX(),this._screenFlashSprite.y=-this.absoluteY(),this._screenFlashSprite.opacity*=(a-1)/a,this._screenFlashSprite.visible=this._screenFlashDuration>0)}},Sprite_Animation.prototype.absoluteX=function(){for(var a=0,b=this;b;)a+=b.x,b=b.parent;return a},Sprite_Animation.prototype.absoluteY=function(){for(var a=0,b=this;b;)a+=b.y,b=b.parent;return a},Sprite_Animation.prototype.updateHiding=function(){this._hidingDuration>0&&(this._hidingDuration--,0===this._hidingDuration&&this._target.show())},Sprite_Animation.prototype.isPlaying=function(){return this._duration>0},Sprite_Animation.prototype.loadBitmaps=function(){var a=this._animation.animation1Name,b=this._animation.animation2Name,c=this._animation.animation1Hue,d=this._animation.animation2Hue;this._bitmap1=ImageManager.loadAnimation(a,c),this._bitmap2=ImageManager.loadAnimation(b,d)},Sprite_Animation.prototype.isReady=function(){return ImageManager.isReady()},Sprite_Animation.prototype.createSprites=function(){Sprite_Animation._checker2[this._animation]||(this.createCellSprites(),3===this._animation.position&&(Sprite_Animation._checker2[this._animation]=!0),this.createScreenFlashSprite()),Sprite_Animation._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,3===this._animation.position&&(Sprite_Animation._checker1[this._animation]=!0))},Sprite_Animation.prototype.createCellSprites=function(){this._cellSprites=[];for(var a=0;16>a;a++){var b=new Sprite;b.anchor.x=.5,b.anchor.y=.5,this._cellSprites.push(b),this.addChild(b)}},Sprite_Animation.prototype.createScreenFlashSprite=function(){this._screenFlashSprite=new ScreenSprite,this.addChild(this._screenFlashSprite)},Sprite_Animation.prototype.updateMain=function(){this.isPlaying()&&this.isReady()&&(this._delay>0?this._delay--:(this._duration--,this.updatePosition(),this._duration%this._rate===0&&this.updateFrame()))},Sprite_Animation.prototype.updatePosition=function(){if(3===this._animation.position)this.x=this.parent.width/2,this.y=this.parent.height/2;else{var a=this._target.parent,b=a?a.parent:null;this.x=this._target.x,this.y=this._target.y,this.parent===b&&(this.x+=a.x,this.y+=a.y),0===this._animation.position?this.y-=this._target.height:1===this._animation.position&&(this.y-=this._target.height/2)}},Sprite_Animation.prototype.updateFrame=function(){if(this._duration>0){var a=this.currentFrameIndex();this.updateAllCellSprites(this._animation.frames[a]),this._animation.timings.forEach(function(b){b.frame===a&&this.processTimingData(b)},this)}},Sprite_Animation.prototype.currentFrameIndex=function(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)},Sprite_Animation.prototype.updateAllCellSprites=function(a){for(var b=0;b<this._cellSprites.length;b++){var c=this._cellSprites[b];b<a.length?this.updateCellSprite(c,a[b]):c.visible=!1}},Sprite_Animation.prototype.updateCellSprite=function(a,b){var c=b[0];if(c>=0){var d=c%5*192,e=192*Math.floor(c%100/5),f=this._mirror;a.bitmap=100>c?this._bitmap1:this._bitmap2,a.setFrame(d,e,192,192),a.x=b[1],a.y=b[2],this._mirror&&(a.x*=-1),a.rotation=b[4]*Math.PI/180,a.scale.x=b[3]/100,(b[5]&&!f||!b[5]&&f)&&(a.scale.x*=-1),a.scale.y=b[3]/100,a.opacity=b[6],a.blendMode=b[7],a.visible=this._target.visible}else a.visible=!1},Sprite_Animation.prototype.processTimingData=function(a){var b=a.flashDuration*this._rate;switch(a.flashScope){case 1:this.startFlash(a.flashColor,b);break;case 2:this.startScreenFlash(a.flashColor,b);break;case 3:this.startHiding(b)}!this._duplicated&&a.se&&AudioManager.playSe(a.se)},Sprite_Animation.prototype.startFlash=function(a,b){this._flashColor=a.clone(),this._flashDuration=b},Sprite_Animation.prototype.startScreenFlash=function(a,b){this._screenFlashDuration=b,this._screenFlashSprite&&(this._screenFlashSprite.setColor(a[0],a[1],a[2]),this._screenFlashSprite.opacity=a[3])},Sprite_Animation.prototype.startHiding=function(a){this._hidingDuration=a,this._target.hide()},Sprite_Damage.prototype=Object.create(Sprite.prototype),Sprite_Damage.prototype.constructor=Sprite_Damage,Sprite_Damage.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._duration=90,this._flashColor=[0,0,0,0],this._flashDuration=0,this._damageBitmap=ImageManager.loadSystem("Damage")},Sprite_Damage.prototype.setup=function(a){var b=a.result();b.missed||b.evaded?this.createMiss():b.hpAffected?this.createDigits(0,b.hpDamage):a.isAlive()&&0!==b.mpDamage&&this.createDigits(2,b.mpDamage),b.critical&&this.setupCriticalEffect()},Sprite_Damage.prototype.setupCriticalEffect=function(){this._flashColor=[255,0,0,160],this._flashDuration=60},Sprite_Damage.prototype.digitWidth=function(){return this._damageBitmap?this._damageBitmap.width/10:0},Sprite_Damage.prototype.digitHeight=function(){return this._damageBitmap?this._damageBitmap.height/5:0},Sprite_Damage.prototype.createMiss=function(){var a=this.digitWidth(),b=this.digitHeight(),c=this.createChildSprite();c.setFrame(0,4*b,4*a,b),c.dy=0},Sprite_Damage.prototype.createDigits=function(a,b){for(var c=Math.abs(b).toString(),d=a+(0>b?1:0),e=this.digitWidth(),f=this.digitHeight(),g=0;g<c.length;g++){var h=this.createChildSprite(),i=Number(c[g]);h.setFrame(i*e,d*f,e,f),h.x=(g-(c.length-1)/2)*e,h.dy=-g}},Sprite_Damage.prototype.createChildSprite=function(){var a=new Sprite;return a.bitmap=this._damageBitmap,a.anchor.x=.5,a.anchor.y=1,a.y=-40,a.ry=a.y,this.addChild(a),a},Sprite_Damage.prototype.update=function(){if(Sprite.prototype.update.call(this),this._duration>0){this._duration--;for(var a=0;a<this.children.length;a++)this.updateChild(this.children[a])}this.updateFlash(),this.updateOpacity()},Sprite_Damage.prototype.updateChild=function(a){a.dy+=.5,a.ry+=a.dy,a.ry>=0&&(a.ry=0,a.dy*=-.6),a.y=Math.round(a.ry),a.setBlendColor(this._flashColor)},Sprite_Damage.prototype.updateFlash=function(){if(this._flashDuration>0){var a=this._flashDuration--;this._flashColor[3]*=(a-1)/a}},Sprite_Damage.prototype.updateOpacity=function(){this._duration<10&&(this.opacity=255*this._duration/10);
},Sprite_Damage.prototype.isPlaying=function(){return this._duration>0},Sprite_StateIcon.prototype=Object.create(Sprite.prototype),Sprite_StateIcon.prototype.constructor=Sprite_StateIcon,Sprite_StateIcon.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateIcon._iconWidth=32,Sprite_StateIcon._iconHeight=32,Sprite_StateIcon.prototype.initMembers=function(){this._battler=null,this._iconIndex=0,this._animationCount=0,this._animationIndex=0,this.anchor.x=.5,this.anchor.y=.5},Sprite_StateIcon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("IconSet"),this.setFrame(0,0,0,0)},Sprite_StateIcon.prototype.setup=function(a){this._battler=a},Sprite_StateIcon.prototype.update=function(){Sprite.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updateIcon(),this.updateFrame(),this._animationCount=0)},Sprite_StateIcon.prototype.animationWait=function(){return 40},Sprite_StateIcon.prototype.updateIcon=function(){var a=[];this._battler&&this._battler.isAlive()&&(a=this._battler.allIcons()),a.length>0?(this._animationIndex++,this._animationIndex>=a.length&&(this._animationIndex=0),this._iconIndex=a[this._animationIndex]):(this._animationIndex=0,this._iconIndex=0)},Sprite_StateIcon.prototype.updateFrame=function(){var a=Sprite_StateIcon._iconWidth,b=Sprite_StateIcon._iconHeight,c=this._iconIndex%16*a,d=Math.floor(this._iconIndex/16)*b;this.setFrame(c,d,a,b)},Sprite_StateOverlay.prototype=Object.create(Sprite_Base.prototype),Sprite_StateOverlay.prototype.constructor=Sprite_StateOverlay,Sprite_StateOverlay.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_StateOverlay.prototype.initMembers=function(){this._battler=null,this._overlayIndex=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1},Sprite_StateOverlay.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("States"),this.setFrame(0,0,0,0)},Sprite_StateOverlay.prototype.setup=function(a){this._battler=a},Sprite_StateOverlay.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)},Sprite_StateOverlay.prototype.animationWait=function(){return 8},Sprite_StateOverlay.prototype.updatePattern=function(){this._pattern++,this._pattern%=8,this._battler&&(this._overlayIndex=this._battler.stateOverlayIndex())},Sprite_StateOverlay.prototype.updateFrame=function(){if(this._overlayIndex>0){var a=96,b=96,c=this._pattern*a,d=(this._overlayIndex-1)*b;this.setFrame(c,d,a,b)}else this.setFrame(0,0,0,0)},Sprite_Weapon.prototype=Object.create(Sprite_Base.prototype),Sprite_Weapon.prototype.constructor=Sprite_Weapon,Sprite_Weapon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers()},Sprite_Weapon.prototype.initMembers=function(){this._weaponImageId=0,this._animationCount=0,this._pattern=0,this.anchor.x=.5,this.anchor.y=1,this.x=-16},Sprite_Weapon.prototype.setup=function(a){this._weaponImageId=a,this._animationCount=0,this._pattern=0,this.loadBitmap(),this.updateFrame()},Sprite_Weapon.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._animationCount++,this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)},Sprite_Weapon.prototype.animationWait=function(){return 12},Sprite_Weapon.prototype.updatePattern=function(){this._pattern++,this._pattern>=3&&(this._weaponImageId=0)},Sprite_Weapon.prototype.loadBitmap=function(){var a=Math.floor((this._weaponImageId-1)/12)+1;a>=1?this.bitmap=ImageManager.loadSystem("Weapons"+a):this.bitmap=ImageManager.loadSystem("")},Sprite_Weapon.prototype.updateFrame=function(){if(this._weaponImageId>0){var a=(this._weaponImageId-1)%12,b=96,c=64,d=(3*Math.floor(a/6)+this._pattern)*b,e=Math.floor(a%6)*c;this.setFrame(d,e,b,c)}else this.setFrame(0,0,0,0)},Sprite_Weapon.prototype.isPlaying=function(){return this._weaponImageId>0},Sprite_Balloon.prototype=Object.create(Sprite_Base.prototype),Sprite_Balloon.prototype.constructor=Sprite_Balloon,Sprite_Balloon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this),this.initMembers(),this.loadBitmap()},Sprite_Balloon.prototype.initMembers=function(){this._balloonId=0,this._duration=0,this.anchor.x=.5,this.anchor.y=1,this.z=7},Sprite_Balloon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("Balloon"),this.setFrame(0,0,0,0)},Sprite_Balloon.prototype.setup=function(a){this._balloonId=a,this._duration=8*this.speed()+this.waitTime()},Sprite_Balloon.prototype.update=function(){Sprite_Base.prototype.update.call(this),this._duration>0&&(this._duration--,this._duration>0&&this.updateFrame())},Sprite_Balloon.prototype.updateFrame=function(){var a=48,b=48,c=this.frameIndex()*a,d=(this._balloonId-1)*b;this.setFrame(c,d,a,b)},Sprite_Balloon.prototype.speed=function(){return 8},Sprite_Balloon.prototype.waitTime=function(){return 12},Sprite_Balloon.prototype.frameIndex=function(){var a=(this._duration-this.waitTime())/this.speed();return 7-Math.max(Math.floor(a),0)},Sprite_Balloon.prototype.isPlaying=function(){return this._duration>0},Sprite_Picture.prototype=Object.create(Sprite.prototype),Sprite_Picture.prototype.constructor=Sprite_Picture,Sprite_Picture.prototype.initialize=function(a){Sprite.prototype.initialize.call(this),this._pictureId=a,this._pictureName="",this.update()},Sprite_Picture.prototype.picture=function(){return $gameScreen.picture(this._pictureId)},Sprite_Picture.prototype.update=function(){Sprite.prototype.update.call(this),this.updateBitmap(),this.visible&&(this.updateOrigin(),this.updatePosition(),this.updateScale(),this.updateTone(),this.updateOther())},Sprite_Picture.prototype.updateBitmap=function(){var a=this.picture();if(a){var b=a.name();this._pictureName!==b&&(this._pictureName=b,this.loadBitmap()),this.visible=!0}else this._pictureName="",this.bitmap=null,this.visible=!1},Sprite_Picture.prototype.updateOrigin=function(){var a=this.picture();0===a.origin()?(this.anchor.x=0,this.anchor.y=0):(this.anchor.x=.5,this.anchor.y=.5)},Sprite_Picture.prototype.updatePosition=function(){var a=this.picture();this.x=Math.floor(a.x()),this.y=Math.floor(a.y())},Sprite_Picture.prototype.updateScale=function(){var a=this.picture();this.scale.x=a.scaleX()/100,this.scale.y=a.scaleY()/100},Sprite_Picture.prototype.updateTone=function(){var a=this.picture();a.tone()?this.setColorTone(a.tone()):this.setColorTone([0,0,0,0])},Sprite_Picture.prototype.updateOther=function(){var a=this.picture();this.opacity=a.opacity(),this.blendMode=a.blendMode(),this.rotation=a.angle()*Math.PI/180},Sprite_Picture.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadPicture(this._pictureName)},Sprite_Timer.prototype=Object.create(Sprite.prototype),Sprite_Timer.prototype.constructor=Sprite_Timer,Sprite_Timer.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this._seconds=0,this.createBitmap(),this.update()},Sprite_Timer.prototype.createBitmap=function(){this.bitmap=new Bitmap(96,48),this.bitmap.fontSize=32},Sprite_Timer.prototype.update=function(){Sprite.prototype.update.call(this),this.updateBitmap(),this.updatePosition(),this.updateVisibility()},Sprite_Timer.prototype.updateBitmap=function(){this._seconds!==$gameTimer.seconds()&&(this._seconds=$gameTimer.seconds(),this.redraw())},Sprite_Timer.prototype.redraw=function(){var a=this.timerText(),b=this.bitmap.width,c=this.bitmap.height;this.bitmap.clear(),this.bitmap.drawText(a,0,0,b,c,"center")},Sprite_Timer.prototype.timerText=function(){var a=Math.floor(this._seconds/60)%60,b=this._seconds%60;return a.padZero(2)+":"+b.padZero(2)},Sprite_Timer.prototype.updatePosition=function(){this.x=Graphics.width-this.bitmap.width,this.y=0},Sprite_Timer.prototype.updateVisibility=function(){this.visible=$gameTimer.isWorking()},Sprite_Destination.prototype=Object.create(Sprite.prototype),Sprite_Destination.prototype.constructor=Sprite_Destination,Sprite_Destination.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.createBitmap(),this._frameCount=0},Sprite_Destination.prototype.update=function(){Sprite.prototype.update.call(this),$gameTemp.isDestinationValid()?(this.updatePosition(),this.updateAnimation(),this.visible=!0):(this._frameCount=0,this.visible=!1)},Sprite_Destination.prototype.createBitmap=function(){var a=$gameMap.tileWidth(),b=$gameMap.tileHeight();this.bitmap=new Bitmap(a,b),this.bitmap.fillAll("white"),this.anchor.x=.5,this.anchor.y=.5,this.blendMode=Graphics.BLEND_ADD},Sprite_Destination.prototype.updatePosition=function(){var a=$gameMap.tileWidth(),b=$gameMap.tileHeight(),c=$gameTemp.destinationX(),d=$gameTemp.destinationY();this.x=($gameMap.adjustX(c)+.5)*a,this.y=($gameMap.adjustY(d)+.5)*b},Sprite_Destination.prototype.updateAnimation=function(){this._frameCount++,this._frameCount%=20,this.opacity=6*(20-this._frameCount),this.scale.x=1+this._frameCount/20,this.scale.y=this.scale.x},Spriteset_Base.prototype=Object.create(Sprite.prototype),Spriteset_Base.prototype.constructor=Spriteset_Base,Spriteset_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this),this.setFrame(0,0,Graphics.width,Graphics.height),this._tone=[0,0,0,0],this.opaque=!0,this.createLowerLayer(),this.createToneChanger(),this.createUpperLayer(),this.update()},Spriteset_Base.prototype.createLowerLayer=function(){this.createBaseSprite()},Spriteset_Base.prototype.createUpperLayer=function(){this.createPictures(),this.createTimer(),this.createScreenSprites()},Spriteset_Base.prototype.update=function(){Sprite.prototype.update.call(this),this.updateScreenSprites(),this.updateToneChanger(),this.updatePosition()},Spriteset_Base.prototype.createBaseSprite=function(){this._baseSprite=new Sprite,this._baseSprite.setFrame(0,0,this.width,this.height),this._blackScreen=new ScreenSprite,this._blackScreen.opacity=255,this.addChild(this._baseSprite),this._baseSprite.addChild(this._blackScreen)},Spriteset_Base.prototype.createToneChanger=function(){Graphics.isWebGL()?this.createWebGLToneChanger():this.createCanvasToneChanger()},Spriteset_Base.prototype.createWebGLToneChanger=function(){var a=48,b=Graphics.width+2*a,c=Graphics.height+2*a;this._toneFilter=new ToneFilter,this._baseSprite.filters=[this._toneFilter],this._baseSprite.filterArea=new Rectangle(-a,-a,b,c)},Spriteset_Base.prototype.createCanvasToneChanger=function(){this._toneSprite=new ToneSprite,this.addChild(this._toneSprite)},Spriteset_Base.prototype.createPictures=function(){var a=Graphics.boxWidth,b=Graphics.boxHeight,c=(Graphics.width-a)/2,d=(Graphics.height-b)/2;this._pictureContainer=new Sprite,this._pictureContainer.setFrame(c,d,a,b);for(var e=1;e<=$gameScreen.maxPictures();e++)this._pictureContainer.addChild(new Sprite_Picture(e));this.addChild(this._pictureContainer)},Spriteset_Base.prototype.createTimer=function(){this._timerSprite=new Sprite_Timer,this.addChild(this._timerSprite)},Spriteset_Base.prototype.createScreenSprites=function(){this._flashSprite=new ScreenSprite,this._fadeSprite=new ScreenSprite,this.addChild(this._flashSprite),this.addChild(this._fadeSprite)},Spriteset_Base.prototype.updateScreenSprites=function(){var a=$gameScreen.flashColor();this._flashSprite.setColor(a[0],a[1],a[2]),this._flashSprite.opacity=a[3],this._fadeSprite.opacity=255-$gameScreen.brightness()},Spriteset_Base.prototype.updateToneChanger=function(){var a=$gameScreen.tone();this._tone.equals(a)||(this._tone=a.clone(),Graphics.isWebGL()?this.updateWebGLToneChanger():this.updateCanvasToneChanger())},Spriteset_Base.prototype.updateWebGLToneChanger=function(){var a=this._tone;this._toneFilter.reset(),this._toneFilter.adjustTone(a[0],a[1],a[2]),this._toneFilter.adjustSaturation(-a[3])},Spriteset_Base.prototype.updateCanvasToneChanger=function(){var a=this._tone;this._toneSprite.setTone(a[0],a[1],a[2],a[3])},Spriteset_Base.prototype.updatePosition=function(){var a=$gameScreen,b=a.zoomScale();this.scale.x=b,this.scale.y=b,this.x=Math.round(-a.zoomX()*(b-1)),this.y=Math.round(-a.zoomY()*(b-1)),this.x+=Math.round(a.shake())},Spriteset_Map.prototype=Object.create(Spriteset_Base.prototype),Spriteset_Map.prototype.constructor=Spriteset_Map,Spriteset_Map.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this)},Spriteset_Map.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this),this.createParallax(),this.createTilemap(),this.createCharacters(),this.createShadow(),this.createDestination(),this.createWeather()},Spriteset_Map.prototype.update=function(){Spriteset_Base.prototype.update.call(this),this.updateTileset(),this.updateParallax(),this.updateTilemap(),this.updateShadow(),this.updateWeather()},Spriteset_Map.prototype.hideCharacters=function(){for(var a=0;a<this._characterSprites.length;a++){var b=this._characterSprites[a];b.isTile()||b.hide()}},Spriteset_Map.prototype.createParallax=function(){this._parallax=new TilingSprite,this._parallax.move(0,0,Graphics.width,Graphics.height),this._baseSprite.addChild(this._parallax)},Spriteset_Map.prototype.createTilemap=function(){this._tilemap=new Tilemap,this._tilemap.tileWidth=$gameMap.tileWidth(),this._tilemap.tileHeight=$gameMap.tileHeight(),this._tilemap.setData($gameMap.width(),$gameMap.height(),$gameMap.data()),this._tilemap.horizontalWrap=$gameMap.isLoopHorizontal(),this._tilemap.verticalWrap=$gameMap.isLoopVertical(),this.loadTileset(),this._baseSprite.addChild(this._tilemap)},Spriteset_Map.prototype.loadTileset=function(){if(this._tileset=$gameMap.tileset(),this._tileset){for(var a=this._tileset.tilesetNames,b=0;b<a.length;b++)this._tilemap.bitmaps[b]=ImageManager.loadTileset(a[b]);this._tilemap.flags=$gameMap.tilesetFlags(),this._tilemap.refresh()}},Spriteset_Map.prototype.createCharacters=function(){this._characterSprites=[],$gameMap.events().forEach(function(a){this._characterSprites.push(new Sprite_Character(a))},this),$gameMap.vehicles().forEach(function(a){this._characterSprites.push(new Sprite_Character(a))},this),$gamePlayer.followers().reverseEach(function(a){this._characterSprites.push(new Sprite_Character(a))},this),this._characterSprites.push(new Sprite_Character($gamePlayer));for(var a=0;a<this._characterSprites.length;a++)this._tilemap.addChild(this._characterSprites[a])},Spriteset_Map.prototype.createShadow=function(){this._shadowSprite=new Sprite,this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow1"),this._shadowSprite.anchor.x=.5,this._shadowSprite.anchor.y=1,this._shadowSprite.z=6,this._tilemap.addChild(this._shadowSprite)},Spriteset_Map.prototype.createDestination=function(){this._destinationSprite=new Sprite_Destination,this._destinationSprite.z=9,this._tilemap.addChild(this._destinationSprite)},Spriteset_Map.prototype.createWeather=function(){this._weather=new Weather,this.addChild(this._weather)},Spriteset_Map.prototype.updateTileset=function(){this._tileset!==$gameMap.tileset()&&this.loadTileset()},Spriteset_Map.prototype.updateParallax=function(){this._parallaxName!==$gameMap.parallaxName()&&(this._parallaxName=$gameMap.parallaxName(),this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName)),this._parallax.bitmap&&(this._parallax.origin.x=$gameMap.parallaxOx(),this._parallax.origin.y=$gameMap.parallaxOy())},Spriteset_Map.prototype.updateTilemap=function(){this._tilemap.origin.x=$gameMap.displayX()*$gameMap.tileWidth(),this._tilemap.origin.y=$gameMap.displayY()*$gameMap.tileHeight()},Spriteset_Map.prototype.updateShadow=function(){var a=$gameMap.airship();this._shadowSprite.x=a.shadowX(),this._shadowSprite.y=a.shadowY(),this._shadowSprite.opacity=a.shadowOpacity()},Spriteset_Map.prototype.updateWeather=function(){this._weather.type=$gameScreen.weatherType(),this._weather.power=$gameScreen.weatherPower(),this._weather.origin.x=$gameMap.displayX()*$gameMap.tileWidth(),this._weather.origin.y=$gameMap.displayY()*$gameMap.tileHeight()},Spriteset_Battle.prototype=Object.create(Spriteset_Base.prototype),Spriteset_Battle.prototype.constructor=Spriteset_Battle,Spriteset_Battle.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this),this._battlebackLocated=!1},Spriteset_Battle.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this),this.createBackground(),this.createBattleField(),this.createBattleback(),this.createEnemies(),this.createActors()},Spriteset_Battle.prototype.createBackground=function(){this._backgroundSprite=new Sprite,this._backgroundSprite.bitmap=SceneManager.backgroundBitmap(),this._baseSprite.addChild(this._backgroundSprite)},Spriteset_Battle.prototype.update=function(){Spriteset_Base.prototype.update.call(this),this.updateActors(),this.updateBattleback()},Spriteset_Battle.prototype.createBattleField=function(){var a=Graphics.boxWidth,b=Graphics.boxHeight,c=(Graphics.width-a)/2,d=(Graphics.height-b)/2;this._battleField=new Sprite,this._battleField.setFrame(c,d,a,b),this._battleField.x=c,this._battleField.y=d,this._baseSprite.addChild(this._battleField)},Spriteset_Battle.prototype.createBattleback=function(){var a=32,b=-this._battleField.x-a,c=-this._battleField.y-a,d=Graphics.width+2*a,e=Graphics.height+2*a;this._back1Sprite=new TilingSprite,this._back2Sprite=new TilingSprite,this._back1Sprite.bitmap=this.battleback1Bitmap(),this._back2Sprite.bitmap=this.battleback2Bitmap(),this._back1Sprite.move(b,c,d,e),this._back2Sprite.move(b,c,d,e),this._battleField.addChild(this._back1Sprite),this._battleField.addChild(this._back2Sprite)},Spriteset_Battle.prototype.updateBattleback=function(){this._battlebackLocated||(this.locateBattleback(),this._battlebackLocated=!0)},Spriteset_Battle.prototype.locateBattleback=function(){var a=this._battleField.width,b=this._battleField.height,c=this._back1Sprite,d=this._back2Sprite;c.origin.x=c.x+(c.bitmap.width-a)/2,d.origin.x=c.y+(d.bitmap.width-a)/2,$gameSystem.isSideView()&&(c.origin.y=c.x+c.bitmap.height-b,d.origin.y=c.y+d.bitmap.height-b)},Spriteset_Battle.prototype.battleback1Bitmap=function(){return ImageManager.loadBattleback1(this.battleback1Name())},Spriteset_Battle.prototype.battleback2Bitmap=function(){return ImageManager.loadBattleback2(this.battleback2Name())},Spriteset_Battle.prototype.battleback1Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback1Name:$gameMap.battleback1Name()?$gameMap.battleback1Name():$gameMap.isOverworld()?this.overworldBattleback1Name():""},Spriteset_Battle.prototype.battleback2Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback2Name:$gameMap.battleback2Name()?$gameMap.battleback2Name():$gameMap.isOverworld()?this.overworldBattleback2Name():""},Spriteset_Battle.prototype.overworldBattleback1Name=function(){return $gamePlayer.isInVehicle()?this.shipBattleback1Name():this.normalBattleback1Name()},Spriteset_Battle.prototype.overworldBattleback2Name=function(){return $gamePlayer.isInVehicle()?this.shipBattleback2Name():this.normalBattleback2Name()},Spriteset_Battle.prototype.normalBattleback1Name=function(){return this.terrainBattleback1Name(this.autotileType(1))||this.terrainBattleback1Name(this.autotileType(0))||this.defaultBattleback1Name()},Spriteset_Battle.prototype.normalBattleback2Name=function(){return this.terrainBattleback2Name(this.autotileType(1))||this.terrainBattleback2Name(this.autotileType(0))||this.defaultBattleback2Name()},Spriteset_Battle.prototype.terrainBattleback1Name=function(a){switch(a){case 24:case 25:return"Wasteland";case 26:case 27:return"DirtField";case 32:case 33:return"Desert";case 34:return"Lava1";case 35:return"Lava2";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp";default:return null}},Spriteset_Battle.prototype.terrainBattleback2Name=function(a){switch(a){case 20:case 21:return"Forest";case 22:case 30:case 38:return"Cliff";case 24:case 25:case 26:case 27:return"Wasteland";case 32:case 33:return"Desert";case 34:case 35:return"Lava";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp"}},Spriteset_Battle.prototype.defaultBattleback1Name=function(){return"Grassland"},Spriteset_Battle.prototype.defaultBattleback2Name=function(){return"Grassland"},Spriteset_Battle.prototype.shipBattleback1Name=function(){return"Ship"},Spriteset_Battle.prototype.shipBattleback2Name=function(){return"Ship"},Spriteset_Battle.prototype.autotileType=function(a){return $gameMap.autotileType($gamePlayer.x,$gamePlayer.y,a)},Spriteset_Battle.prototype.createEnemies=function(){for(var a=$gameTroop.members(),b=[],c=0;c<a.length;c++)b[c]=new Sprite_Enemy(a[c]);b.sort(this.compareEnemySprite.bind(this));for(var d=0;d<b.length;d++)this._battleField.addChild(b[d]);this._enemySprites=b},Spriteset_Battle.prototype.compareEnemySprite=function(a,b){return a.y!==b.y?a.y-b.y:b.spriteId-a.spriteId},Spriteset_Battle.prototype.createActors=function(){this._actorSprites=[];for(var a=0;a<$gameParty.maxBattleMembers();a++)this._actorSprites[a]=new Sprite_Actor,this._battleField.addChild(this._actorSprites[a])},Spriteset_Battle.prototype.updateActors=function(){for(var a=$gameParty.battleMembers(),b=0;b<this._actorSprites.length;b++)this._actorSprites[b].setBattler(a[b])},Spriteset_Battle.prototype.battlerSprites=function(){return this._enemySprites.concat(this._actorSprites)},Spriteset_Battle.prototype.isAnimationPlaying=function(){return this.battlerSprites().some(function(a){return a.isAnimationPlaying()})},Spriteset_Battle.prototype.isEffecting=function(){return this.battlerSprites().some(function(a){return a.isEffecting()})},Spriteset_Battle.prototype.isAnyoneMoving=function(){return this.battlerSprites().some(function(a){return a.isMoving()})},Spriteset_Battle.prototype.isBusy=function(){return this.isAnimationPlaying()||this.isAnyoneMoving()};